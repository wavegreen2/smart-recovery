<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baccarat Strategy & Bead Plate</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f4f7f6; color: #333; margin: 20px; }
        .container { max-width: 950px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-top: 0; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .card { border: 1px solid #ddd; padding: 15px; border-radius: 8px; background: #fafafa; }
        label { display: block; margin-top: 10px; font-weight: bold; font-size: 0.85em; }
        input, select { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        
        /* Road Containers */
        .road-section { margin-top: 20px; background: #fff; padding: 10px; border: 1px solid #ccc; border-radius: 8px; overflow-x: auto; }
        .road-title { font-size: 0.8em; font-weight: bold; color: #7f8c8d; margin-bottom: 5px; text-transform: uppercase; }
        
        /* Bead Plate Styles */
        .bead-grid { display: grid; grid-template-rows: repeat(6, 30px); grid-auto-columns: 30px; grid-auto-flow: column; gap: 2px; }
        .bead { width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 14px; }
        .bead.P { background: #3498db; }
        .bead.B { background: #e74c3c; }
        .bead.T { background: #27ae60; }

        /* Big Road Styles */
        .big-road-grid { display: grid; grid-template-rows: repeat(6, 20px); grid-auto-columns: 20px; grid-auto-flow: column; gap: 1px; background-color: #eee; border: 1px solid #ddd; width: max-content; }
        .big-cell { width: 20px; height: 20px; background: white; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; position: relative; }
        .big-circle { width: 16px; height: 16px; border-radius: 50%; border-width: 2px; border-style: solid; }
        .big-circle.P { border-color: #3498db; }
        .big-circle.B { border-color: #e74c3c; }
        .tie-line { position: absolute; width: 2px; height: 18px; background: #27ae60; transform: rotate(45deg); }

        /* Next Bet & Stats */
        .next-bet-box { padding: 20px; border-radius: 8px; margin: 20px 0; text-align: center; font-size: 1.4em; font-weight: bold; border: 2px solid #ddd; background: #eee; min-height: 40px; }
        .stat-box { display: flex; justify-content: space-between; background: #34495e; color: white; padding: 15px; border-radius: 8px; margin-top: 20px; }
        
        /* Buttons */
        .btn-group { margin-top: 15px; display: flex; gap: 10px; }
        button { flex: 1; padding: 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.3s; font-size: 1em; }
        .btn-p { background: #3498db; color: white; }
        .btn-b { background: #e74c3c; color: white; }
        .btn-t { background: #27ae60; color: white; }
        .btn-back { background: #f39c12; color: white; }
        .btn-reset { background: #95a5a6; color: white; }
        button:hover { opacity: 0.8; }
        #log-area { margin-top: 20px; background: #2c3e50; color: #ecf0f1; padding: 15px; height: 150px; overflow-y: auto; border-radius: 8px; font-family: monospace; font-size: 0.85em; }
    </style>
</head>
<body>

<div class="container">
    <h2>üìä Baccarat Strategy & Road Map</h2>
    
    <div class="grid">
        <div class="card">
            <label>Side Preference:</label>
            <select id="sidePreference" onchange="updateUI()">
                <option value="PLAYER" selected>PLAYER</option>
                <option value="BANKER">BANKER</option>
            </select>
            <label>Unit Size:</label>
            <input type="number" id="unitSize" value="10.0">
            <label>Martingale Multiplier:</label>
            <input type="number" id="martyMult" value="2.0">
            <label>Fibonacci Multiplier:</label>
            <input type="number" id="fiboMult" value="1000000.0">
        </div>
        <div class="card">
            <label>Initial Bankroll:</label>
            <input type="number" id="initBR" value="20.0">
            <label>Virtual Loss Trigger (‡∏Ñ‡∏£‡∏±‡πâ‡∏á):</label>
            <input type="number" id="vLossTrigger" value="1">
            <label>Base Profit Target:</label>
            <input type="number" id="baseInc" value="0.01">
            <label>Stop Loss:</label>
            <input type="number" id="stopLoss" value="1000000.0">
        </div>
    </div>

    <div class="road-section">
        <div class="road-title">Bead Plate</div>
        <div id="beadGrid" class="bead-grid"></div>
    </div>

    <div class="road-section">
        <div class="road-title">Big Road</div>
        <div id="bigRoadGrid" class="big-road-grid"></div>
    </div>

    <div id="next-bet-display" class="next-bet-box">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô - NO BET</div>

    <div class="stat-box">
        <div>Profit: <span id="stat-profit">0.00</span></div>
        <div>Max Bet: <span id="stat-maxbet">0.00</span></div>
        <div>Mode: <span id="stat-mode">WAITING</span></div>
    </div>

    <div class="btn-group">
        <button class="btn-p" onclick="processResult('P')">P</button>
        <button class="btn-b" onclick="processResult('B')">B</button>
        <button class="btn-t" onclick="processResult('T')">T</button>
    </div>
    <div class="btn-group">
        <button class="btn-back" onclick="undoLast()">BACK (‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö)</button>
        <button class="btn-reset" onclick="resetAll()">RESET ALL</button>
    </div>

    <div id="log-area">--- Ready ---</div>
</div>

<script>
/** State & Logic **/
let history = [];
let globalState = {
    totalAccumulatedProfit: 0, currentSessionBR: 0, currentSessionTarget: 0,
    consecutiveVirtualLosses: 0, totalRealSessions: 0, overallMaxBet: 0,
    bankroll: 0, peakBankroll: 0, state: "FLAT", martyStep: 0, fiboIdx: 0,
    handCount: 0, hasLostSincePeak: false, initialBRInSession: 0
};

let stateHistory = [];

function getFibo(n) {
    if (n <= 0) return 1;
    if (n === 1) return 1;
    let a = 1, b = 1;
    for (let i = 2; i <= n; i++) {
        let temp = b; b = a + b; a = temp;
    }
    return b;
}

function getConfig() {
    return {
        unitSize: parseFloat(document.getElementById('unitSize').value),
        martyMult: parseFloat(document.getElementById('martyMult').value),
        fiboMult: parseFloat(document.getElementById('fiboMult').value),
        stopLoss: parseFloat(document.getElementById('stopLoss').value),
        initBR: parseFloat(document.getElementById('initBR').value),
        vLossTrigger: parseInt(document.getElementById('vLossTrigger').value),
        rebateRate: 0.01,
        baseInc: parseFloat(document.getElementById('baseInc').value),
        side: document.getElementById('sidePreference').value
    };
}

function saveState() {
    stateHistory.push(JSON.parse(JSON.stringify({
        state: globalState,
        history: history
    })));
}

function undoLast() {
    if (stateHistory.length === 0) return;
    const last = stateHistory.pop();
    globalState = last.state;
    history = last.history;
    updateUI();
    document.getElementById('log-area').prepend(document.createElement('div')).innerText = "‚Ü∫ Undo Last Action";
}

function initSession() {
    const config = getConfig();
    if (globalState.handCount === 0) {
        if (globalState.totalRealSessions === 0 && globalState.totalAccumulatedProfit === 0) {
            globalState.currentSessionBR = config.initBR;
            globalState.currentSessionTarget = config.baseInc;
        }
        globalState.bankroll = globalState.currentSessionBR;
        globalState.initialBRInSession = globalState.currentSessionBR;
        globalState.peakBankroll = globalState.currentSessionBR;
        globalState.state = "FLAT";
        globalState.martyStep = 0;
        globalState.fiboIdx = 0;
        globalState.hasLostSincePeak = false;
    }
}

function calculateNextBet() {
    // Logic: ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏° session ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ null
    if (globalState.handCount === 0 && globalState.totalRealSessions === 0 && globalState.totalAccumulatedProfit === 0) return null;
    
    initSession();
    const config = getConfig();
    let currentDrawdown = globalState.peakBankroll - globalState.bankroll;
    let bet = 0;
    
    if (globalState.state === "FLAT") {
        bet = (currentDrawdown > 0 && globalState.hasLostSincePeak) ? Math.max(Math.ceil(currentDrawdown / 4), config.unitSize) : config.unitSize;
    } else if (globalState.state === "MARTY") {
        bet = config.unitSize * Math.pow(config.martyMult, globalState.martyStep);
    } else if (globalState.state === "FIBO") {
        bet = getFibo(globalState.fiboIdx) * config.fiboMult;
    }

    let neededToRecover = currentDrawdown + config.unitSize;
    if (globalState.state !== "FLAT") bet = Math.min(bet, neededToRecover);
    if (bet >= config.stopLoss) bet = config.stopLoss;

    let currentProfitThisSession = globalState.bankroll - globalState.initialBRInSession;
    let remainingToTarget = globalState.currentSessionTarget - currentProfitThisSession;
    if (bet > remainingToTarget && remainingToTarget > 0) bet = Math.max(config.unitSize, remainingToTarget);

    return bet;
}

function processResult(actualResult) {
    saveState();
    initSession();
    const config = getConfig();
    const isVirtual = globalState.consecutiveVirtualLosses < config.vLossTrigger;
    
    if (actualResult === 'T') {
        history.push('T');
        updateUI();
        return;
    }

    let bet = calculateNextBet() || config.unitSize;
    let isMaxBetActive = bet >= config.stopLoss;
    if (bet > globalState.overallMaxBet) globalState.overallMaxBet = bet;

    const isWin = (actualResult === 'P' && config.side === 'PLAYER') || (actualResult === 'B' && config.side === 'BANKER');
    const payout = (config.side === 'BANKER') ? 0.95 : 1.0;
    
    globalState.bankroll += (bet * 0.01);
    globalState.handCount++;
    history.push(actualResult);

    if (isWin) {
        globalState.bankroll += (bet * payout);
        if (globalState.state === "FIBO") {
            globalState.fiboIdx = Math.max(-1, globalState.fiboIdx - 2);
            if (globalState.fiboIdx < 0) { globalState.state = "FLAT"; globalState.fiboIdx = 0; }
        } else {
            if (globalState.bankroll >= globalState.peakBankroll) globalState.hasLostSincePeak = false;
            globalState.state = "FLAT"; globalState.martyStep = 0;
        }
    } else {
        globalState.bankroll -= bet;
        globalState.hasLostSincePeak = true;
        if (isMaxBetActive) {
            globalState.state = "FLAT"; globalState.martyStep = 0; globalState.fiboIdx = 0;
        } else {
            if (globalState.state === "FLAT") { globalState.state = "MARTY"; globalState.martyStep = 1; }
            else if (globalState.state === "MARTY") { 
                globalState.martyStep++; 
                if (globalState.martyStep > 12) { globalState.state = "FIBO"; globalState.fiboIdx = 0; }
            }
            else if (globalState.state === "FIBO") { globalState.fiboIdx++; }
        }
    }

    if (globalState.bankroll > globalState.peakBankroll) globalState.peakBankroll = globalState.bankroll;

    if (globalState.bankroll <= 0 || (globalState.bankroll - globalState.initialBRInSession) >= globalState.currentSessionTarget) {
        const sessionProfit = globalState.bankroll - globalState.initialBRInSession;
        if (isVirtual) {
            globalState.consecutiveVirtualLosses = (globalState.bankroll <= 0) ? globalState.consecutiveVirtualLosses + 1 : 0;
        } else {
            globalState.totalAccumulatedProfit += sessionProfit;
            globalState.totalRealSessions++;
            if (globalState.bankroll > 0) {
                globalState.currentSessionTarget = config.baseInc;
                globalState.currentSessionBR = config.initBR + globalState.totalAccumulatedProfit;
            } else {
                globalState.currentSessionTarget = Math.abs(globalState.totalAccumulatedProfit) + config.baseInc;
                globalState.currentSessionBR = globalState.currentSessionTarget * 1.5;
            }
            globalState.consecutiveVirtualLosses = 0;
        }
        globalState.handCount = 0;
    }
    updateUI();
}

function renderBigRoad() {
    const bigRoadGrid = document.getElementById('bigRoadGrid');
    bigRoadGrid.innerHTML = '';
    
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤ 6 ‡πÅ‡∏ñ‡∏ß x 40 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå (‡∏Ç‡∏¢‡∏≤‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
    let matrix = Array(6).fill().map(() => Array(100).fill(null));
    let col = 0, row = 0;
    let lastResult = null;

    history.forEach(res => {
        if (res === 'T') {
            // Tie Logic: ‡πÉ‡∏™‡πà‡∏Ç‡∏µ‡∏î‡πÉ‡∏ô Cell ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
            return; 
        }

        if (!lastResult) {
            matrix[row][col] = { res: res, ties: 0 };
            lastResult = res;
        } else if (res === lastResult) {
            if (row + 1 < 6 && matrix[row + 1][col] === null) {
                row++;
            } else {
                col++; // ‡∏´‡∏≤‡∏á‡∏°‡∏±‡∏á‡∏Å‡∏£ (Dragon tail)
            }
            matrix[row][col] = { res: res, ties: 0 };
        } else {
            row = 0;
            col++;
            while(matrix[row][col] !== null) col++; // ‡∏´‡∏≤‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ß‡πà‡∏≤‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
            matrix[row][col] = { res: res, ties: 0 };
            lastResult = res;
        }
        
        // ‡∏ô‡∏±‡∏ö Tie (‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢: ‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤)
        let tiesInThisHand = 0;
        let idx = history.indexOf(res);
        // (‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏ô‡∏±‡∏ö tie ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ô‡∏µ‡πâ)
    });

    // Render cells
    for (let c = 0; c < 50; c++) {
        for (let r = 0; r < 6; r++) {
            const cell = document.createElement('div');
            cell.className = 'big-cell';
            if (matrix[r][c]) {
                const circle = document.createElement('div');
                circle.className = `big-circle ${matrix[r][c].res}`;
                cell.appendChild(circle);
            }
            bigRoadGrid.appendChild(cell);
        }
    }
}

function updateUI() {
    const config = getConfig();
    const nextBetAmount = calculateNextBet();
    const nextBetEl = document.getElementById('next-bet-display');
    const statusEl = document.getElementById('stat-mode');
    
    // Bead Plate Render
    const beadGrid = document.getElementById('beadGrid');
    beadGrid.innerHTML = '';
    history.forEach(res => {
        const d = document.createElement('div');
        d.className = `bead ${res}`;
        d.innerText = res;
        beadGrid.appendChild(d);
    });

    // Big Road Render
    renderBigRoad();

    document.getElementById('stat-profit').innerText = globalState.totalAccumulatedProfit.toFixed(4);
    document.getElementById('stat-maxbet').innerText = globalState.overallMaxBet.toLocaleString();

    // Next Bet Display Logic - ‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    if (nextBetAmount === null) {
        nextBetEl.innerText = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô - NO BET";
        nextBetEl.style.background = "#eee";
        nextBetEl.style.color = "#333";
        statusEl.innerText = "WAITING";
    } else {
        if (globalState.consecutiveVirtualLosses < config.vLossTrigger) {
            statusEl.innerText = "VIRTUAL WAIT";
            nextBetEl.innerHTML = `üî≠ VIRTUAL: <small>‡∏£‡∏≠‡∏à‡∏ö‡∏ä‡∏∏‡∏î‡∏ô‡∏µ‡πâ</small>`;
            nextBetEl.style.background = "#f1c40f";
            nextBetEl.style.color = "#2c3e50";
        } else {
            statusEl.innerText = "REAL BETTING";
            nextBetEl.style.color = "white";
            const sideTxt = config.side === 'PLAYER' ? 'PLAYER' : 'BANKER';
            nextBetEl.style.background = config.side === 'PLAYER' ? "#3498db" : "#e74c3c";
            nextBetEl.innerHTML = `üî• REAL BET: ${sideTxt} (${nextBetAmount.toLocaleString()})`;
        }
    }
}

function resetAll() {
    if(!confirm("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) return;
    history = []; stateHistory = [];
    globalState = {
        totalAccumulatedProfit: 0, currentSessionBR: 0, currentSessionTarget: 0,
        consecutiveVirtualLosses: 0, totalRealSessions: 0, overallMaxBet: 0,
        bankroll: 0, peakBankroll: 0, state: "FLAT", martyStep: 0, fiboIdx: 0,
        handCount: 0, hasLostSincePeak: false, initialBRInSession: 0
    };
    updateUI();
}
</script>
</body>
</html>


