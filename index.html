<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baccarat Fixed Strategy System</title>
    <style>
        :root { --p-color: #007bff; --b-color: #dc3545; --t-color: #28a745; --bg-dark: #1a1a1a; --card-bg: #2d2d2d; }
        body { font-family: 'Inter', 'Sarabun', sans-serif; background: var(--bg-dark); color: #fff; margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: auto; }
        .grid-layout { display: grid; grid-template-columns: 320px 1fr; gap: 20px; }
        
        .card { background: var(--card-bg); border-radius: 10px; padding: 20px; margin-bottom: 20px; border: 1px solid #444; }
        h3 { margin-top: 0; border-bottom: 1px solid #444; padding-bottom: 10px; color: #ffca28; font-size: 1rem; }
        
        /* Big Road Corrected */
        .road-wrapper { background: #fff; padding: 5px; border-radius: 4px; overflow-x: auto; margin-bottom: 20px; }
        .road-container { 
            display: grid; 
            grid-template-columns: repeat(100, 25px); 
            grid-template-rows: repeat(6, 25px); 
            gap: 1px; 
            background: #ccc;
            width: fit-content;
        }
        .road-cell { background: #fff; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; position: relative; }
        .cell-P { color: var(--p-color); } .cell-B { color: var(--b-color); } .cell-T { color: var(--t-color); border: 1px solid var(--t-color); border-radius: 50%; width: 20px; height: 20px; }

        /* Betting Advice */
        .bet-banner { display: flex; justify-content: space-between; align-items: center; padding: 25px; border-radius: 8px; margin-bottom: 20px; font-size: 1.8em; font-weight: 800; border: 2px solid #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .bet-P { background: var(--p-color); } .bet-B { background: var(--b-color); } .bet-WAIT { background: #444; }

        /* Stats */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .stat-box { background: #3d3d3d; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #555; }
        .stat-val { font-size: 1.2em; font-weight: bold; display: block; margin-top: 5px; }
        .profit-plus { color: #2ecc71; } .profit-minus { color: #e74c3c; }

        /* Hidden Controls per request */
        .hidden-menu { display: none; }

        .btn { cursor: pointer; border: none; border-radius: 5px; font-weight: bold; transition: 0.2s; padding: 12px; }
        .btn-start { background: #28a745; color: white; width: 100%; font-size: 1.1em; margin-bottom: 10px; }
        .btn-manual { flex: 1; height: 70px; font-size: 1.3em; color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); }
        .logs { background: #000; height: 200px; overflow-y: auto; font-family: 'Courier New', monospace; padding: 10px; border-radius: 5px; font-size: 12px; color: #0f0; border: 1px solid #333; }
    </style>
</head>
<body>

<div class="container">
    <div class="grid-layout">
        <div class="sidebar">
            <div class="card">
                <h3>‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö (Config)</h3>
                <p style="font-size: 0.8em; color: #888;">*‡∏£‡∏∞‡∏ö‡∏ö‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏≤‡∏° CONFIG ‡∏Ñ‡∏á‡∏ó‡∏µ‡πà</p>
                
                <label style="font-size: 0.85em;">‡πÇ‡∏´‡∏°‡∏î (Mode):</label>
                <select id="mode" onchange="toggleMode()">
                    <option value="m">Manual Input (‡∏Å‡∏î‡∏°‡∏∑‡∏≠)</option>
                    <option value="r">Random Simulation (‡∏™‡∏∏‡πà‡∏°)</option>
                </select>

                <div class="hidden-menu">
                    <input type="number" id="virtual_loss_trigger" value="5">
                    <input type="number" id="marty_mult" value="2.0">
                    <input type="number" id="fibo_mult" value="1.0">
                </div>

                <div style="margin-top: 15px;">
                    <div style="display:flex; justify-content: space-between; font-size: 0.85em; margin-bottom: 5px;">
                        <span>‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ (Min Bet):</span> <span>5.0</span>
                    </div>
                    <div style="display:flex; justify-content: space-between; font-size: 0.85em; margin-bottom: 5px;">
                        <span>‡∏ä‡∏¥‡∏õ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ (Min Chip):</span> <span>5.0</span>
                    </div>
                    <div style="display:flex; justify-content: space-between; font-size: 0.85em; margin-bottom: 5px;">
                        <span>Stop Loss:</span> <span style="color:#e74c3c;">75,000</span>
                    </div>
                </div>

                <button class="btn btn-start" onclick="startSystem()" style="margin-top: 20px;">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (START)</button>
            </div>

            <div class="card">
                <h3>üìà ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ (Stats)</h3>
                <div class="stat-box" style="margin-bottom: 10px;">
                    <span style="font-size: 0.8em;">‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (Real Net Profit)</span>
                    <span id="stat_net_profit" class="stat-val">0.00</span>
                </div>
                <div class="stat-box">
                    <span style="font-size: 0.8em;">‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏Ø (Commission 1%)</span>
                    <span id="stat_commission" class="stat-val" style="color:#aaa;">0.00</span>
                </div>
            </div>
        </div>

        <div class="main-panel">
            <div class="road-wrapper">
                <div class="road-container" id="big_road"></div>
            </div>

            <div id="bet_banner" class="bet-banner bet-WAIT">
                <span id="next_side">READY</span>
                <span id="next_amount">0.00</span>
            </div>

            <div class="stats-grid">
                <div class="stat-box"><span>Max Bet</span><span id="stat_max_bet" class="stat-val">0</span></div>
                <div class="stat-box"><span>Drawdown</span><span id="stat_mdd" class="stat-val" style="color:#ff4444;">0</span></div>
                <div class="stat-box"><span>Session</span><span id="stat_session" class="stat-val">0</span></div>
            </div>

            <div class="card" id="manual_ctrl">
                <h3>üéÆ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏• (Manual Result)</h3>
                <div style="display:flex; gap:10px;">
                    <button class="btn btn-manual" style="background:var(--p-color)" onclick="inputResult('P')">PLAYER</button>
                    <button class="btn btn-manual" style="background:var(--b-color)" onclick="inputResult('B')">BANKER</button>
                    <button class="btn btn-manual" style="background:var(--t-color)" onclick="inputResult('T')">TIE</button>
                </div>
            </div>

            <div class="logs" id="logs">‡∏£‡∏≠‡∏Å‡∏î START ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°...</div>
        </div>
    </div>
</div>

<script>
    const CONFIG = {
        initial_bankroll: 500000.0,
        unit_size: 5.0,
        chip_size: 5.0,
        side_preference: "PLAYER",
        virtual_win_trigger: 5,
        stop_after_consecutive_loss: 4,
        recovery_mode: "aggressive",
        recovery_ratio: 5,
        max_unit_cap: 1,
        marty_mult: 2.0,
        marty_steps_limit: 12,
        fibo_mult: 1.0,
        stop_loss_threshold: 75000.0
    };

    let app = {
        isRunning: false,
        netProfit: 0,
        totalComm: 0,
        maxBet: 0,
        maxDD: 0,
        sessionCount: 0,
        history: [],
        
        // Internal Session Logic
        br: CONFIG.initial_bankroll,
        peak: CONFIG.initial_bankroll,
        state: "FLAT",
        martyStep: 0,
        fiboIdx: 0,
        lossSincePeak: false,
        targetProfit: 0.01,
        accumulatedLoss: 0,
        vLossCount: 0
    };

    function startSystem() {
        app.isRunning = true;
        app.netProfit = 0;
        app.totalComm = 0;
        app.history = [];
        app.sessionCount = 1;
        document.getElementById('logs').innerHTML = "SYSTEM ONLINE...";
        resetSession();
        updateUI();
        
        if(document.getElementById('mode').value === 'r') {
            runRandomLoop();
        }
    }

    function resetSession() {
        app.br = CONFIG.initial_bankroll;
        app.peak = CONFIG.initial_bankroll;
        app.state = "FLAT";
        app.martyStep = 0;
        app.fiboIdx = 0;
        app.lossSincePeak = false;
        renderRoad();
    }

    function calculateBet() {
        let drawdown = app.peak - app.br;
        let bet = CONFIG.unit_size;

        if (drawdown >= CONFIG.stop_loss_threshold) {
            app.state = "FLAT"; app.martyStep = 0;
        }

        if (app.state === "FLAT") {
            bet = (drawdown > 0 && app.lossSincePeak) ? Math.max(Math.ceil(drawdown / 4), CONFIG.unit_size) : CONFIG.unit_size;
        } else if (app.state === "MARTY") {
            bet = CONFIG.unit_size * Math.pow(CONFIG.marty_mult, app.martyStep);
        }

        // Apply Config constraints
        let needed = drawdown + CONFIG.unit_size;
        if (app.state !== "FLAT") bet = Math.min(bet, needed);
        if (bet > CONFIG.stop_loss_threshold) bet = CONFIG.stop_loss_threshold;

        // Round to chip size
        return Math.ceil(bet / CONFIG.chip_size) * CONFIG.chip_size;
    }

    function inputResult(res) {
        if (!app.isRunning) return;
        
        const bet = calculateBet();
        const isVirtual = app.vLossCount < CONFIG.virtual_win_trigger;
        const win = (res === 'P' && CONFIG.side_preference === 'PLAYER') || (res === 'B' && CONFIG.side_preference === 'BANKER');

        if (res !== 'T') {
            app.history.push(res);
            // Commission
            let comm = bet * 0.01;
            app.totalComm += comm;
            app.br += comm;
            if(!isVirtual) app.netProfit += comm;

            if (win) {
                let payout = (CONFIG.side_preference === 'BANKER') ? 0.95 : 1.0;
                let profit = bet * payout;
                app.br += profit;
                if(!isVirtual) app.netProfit += profit;
                
                app.state = "FLAT"; app.martyStep = 0;
                if (app.br >= app.peak) app.lossSincePeak = false;
            } else {
                app.br -= bet;
                if(!isVirtual) app.netProfit -= bet;
                app.lossSincePeak = true;
                
                if (app.state === "FLAT") { app.state = "MARTY"; app.martyStep = 1; }
                else { 
                    app.martyStep++;
                    if (app.martyStep > CONFIG.marty_steps_limit) { app.state = "FLAT"; app.martyStep = 0; }
                }
            }

            if (app.br > app.peak) app.peak = app.br;
            if (bet > app.maxBet) app.maxBet = bet;
            let currentDD = app.peak - app.br;
            if (currentDD > app.maxDD) app.maxDD = currentDD;

            // Session Logic
            let sessionProfit = app.br - CONFIG.initial_bankroll;
            if (app.br <= 0 || sessionProfit >= app.targetProfit || currentDD >= CONFIG.stop_loss_threshold) {
                if (isVirtual) {
                    if (sessionProfit < 0) app.vLossCount++;
                    else app.vLossCount = 0;
                } else {
                    app.sessionCount++;
                    if (sessionProfit >= app.targetProfit) {
                        app.accumulatedLoss = 0; app.targetProfit = 0.01; app.vLossCount = 0;
                    } else {
                        app.accumulatedLoss += Math.abs(sessionProfit);
                        app.targetProfit = app.accumulatedLoss + 0.01;
                    }
                }
                resetSession();
            }
        }
        
        renderRoad();
        updateUI();
        logHand(res, bet, win, isVirtual);
    }

    function renderRoad() {
        const container = document.getElementById('big_road');
        container.innerHTML = '';
        
        let matrix = Array(6).fill().map(() => Array(100).fill(null));
        let col = 0, row = 0;
        let lastRes = '';

        app.history.filter(r => r !== 'T').forEach(res => {
            if (res !== lastRes && lastRes !== '') {
                // Find next empty column's first row
                col++; row = 0;
                while(matrix[0][col] !== null) col++;
            }

            // Dragon Tail Logic
            let targetRow = row;
            let targetCol = col;
            
            if (targetRow >= 6 || matrix[targetRow][targetCol] !== null) {
                // Lean right
                targetRow = row - 1;
                targetCol = col + 1;
                while(matrix[targetRow][targetCol] !== null) targetCol++;
                // Note: Keep updating row/col for next item in same streak
                matrix[targetRow][targetCol] = res;
                col = targetCol; // Move virtual col
            } else {
                matrix[targetRow][targetCol] = res;
                row++;
            }
            lastRes = res;
        });

        // Fill Grid
        for (let r = 0; r < 6; r++) {
            for (let c = 0; c < 100; c++) {
                const cell = document.createElement('div');
                cell.className = 'road-cell';
                if (matrix[r][c]) {
                    cell.innerText = matrix[r][c];
                    cell.className += ' cell-' + matrix[r][c];
                }
                container.appendChild(cell);
            }
        }
        container.parentElement.scrollLeft = container.parentElement.scrollWidth;
    }

    function updateUI() {
        document.getElementById('stat_net_profit').innerText = app.netProfit.toLocaleString(undefined, {minimumFractionDigits:2});
        document.getElementById('stat_net_profit').className = 'stat-val ' + (app.netProfit >= 0 ? 'profit-plus' : 'profit-minus');
        document.getElementById('stat_commission').innerText = app.totalComm.toLocaleString(undefined, {minimumFractionDigits:2});
        document.getElementById('stat_max_bet').innerText = app.maxBet.toLocaleString();
        document.getElementById('stat_mdd').innerText = app.maxDD.toLocaleString();
        document.getElementById('stat_session').innerText = app.sessionCount;

        const bet = calculateBet();
        const trigger = CONFIG.virtual_win_trigger;
        const isVirtual = app.vLossCount < trigger;

        if (isVirtual) {
            document.getElementById('bet_banner').className = "bet-banner bet-WAIT";
            document.getElementById('next_side').innerText = `VIRTUAL (${app.vLossCount}/${trigger})`;
        } else {
            document.getElementById('bet_banner').className = "bet-banner " + (CONFIG.side_preference === 'PLAYER' ? 'bet-P' : 'bet-B');
            document.getElementById('next_side').innerText = "BET " + CONFIG.side_preference;
        }
        document.getElementById('next_amount').innerText = bet.toLocaleString();
    }

    function logHand(res, bet, win, isV) {
        const log = document.getElementById('logs');
        const time = new Date().toLocaleTimeString();
        const type = isV ? "[V]" : "[R]";
        const status = win ? "‚úÖ" : "‚ùå";
        log.innerHTML = `<div>${time} ${type} Bet: ${bet} | Res: ${res} ${status}</div>` + log.innerHTML;
    }

    function toggleMode() {
        const m = document.getElementById('mode').value;
        document.getElementById('manual_ctrl').style.display = (m === 'm' ? 'block' : 'none');
    }

    async function runRandomLoop() {
        while(app.isRunning && document.getElementById('mode').value === 'r') {
            const res = Math.random() > 0.5 ? 'P' : 'B';
            inputResult(res);
            await new Promise(r => setTimeout(r, 500));
        }
    }
</script>
</body>
</html>
