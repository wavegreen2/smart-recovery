<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baccarat Strategy - Infinite Road Map</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f4f7f6; color: #333; margin: 20px; }
        .container { max-width: 950px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-top: 0; }
        
        .road-section { 
            margin-top: 20px; 
            background: #fff; 
            padding: 10px; 
            border: 1px solid #ccc; 
            border-radius: 8px; 
            overflow-x: auto; 
            white-space: nowrap;
            scroll-behavior: smooth;
        }
        .road-title { font-size: 0.8em; font-weight: bold; color: #7f8c8d; margin-bottom: 5px; text-transform: uppercase; }
        
        .big-road-grid { 
            display: grid; 
            grid-template-rows: repeat(6, 20px); 
            grid-auto-columns: 20px; 
            grid-auto-flow: column; 
            gap: 1px; 
            background-color: #eee; 
            border: 1px solid #ddd; 
            width: max-content; 
        }
        .big-cell { width: 20px; height: 20px; background: white; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; position: relative; }
        .big-circle { width: 16px; height: 16px; border-radius: 50%; border-width: 2px; border-style: solid; }
        .big-circle.P { border-color: #3498db; }
        .big-circle.B { border-color: #e74c3c; }

        .next-bet-box { padding: 20px; border-radius: 8px; margin: 20px 0; text-align: center; font-size: 1.4em; font-weight: bold; border: 2px solid #ddd; background: #eee; min-height: 40px; }
        
        /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Last Result */
        .last-result-box { margin-bottom: 10px; font-size: 1.1em; font-weight: bold; text-align: right; padding-right: 10px; }
        .win-text { color: #27ae60; }
        .loss-text { color: #e74c3c; }

        .stat-box { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; background: #34495e; color: white; padding: 15px; border-radius: 8px; margin-top: 20px; font-size: 0.9em; }
        .stat-item { text-align: center; border-right: 1px solid #5d6d7e; }
        .stat-item:last-child { border-right: none; }
        
        .btn-group { margin-top: 15px; display: flex; gap: 10px; }
        button { flex: 1; padding: 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.3s; font-size: 1em; }
        .btn-p { background: #3498db; color: white; }
        .btn-b { background: #e74c3c; color: white; }
        .btn-t { background: #27ae60; color: white; }
        .btn-back { background: #f39c12; color: white; }
        .btn-reset { background: #95a5a6; color: white; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .card { border: 1px solid #ddd; padding: 15px; border-radius: 8px; background: #fafafa; }
        label { display: block; margin-top: 10px; font-weight: bold; font-size: 0.85em; }
        input, select { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        #log-area { margin-top: 20px; background: #2c3e50; color: #ecf0f1; padding: 15px; height: 150px; overflow-y: auto; border-radius: 8px; font-family: monospace; font-size: 0.85em; }
    </style>
</head>
<body>

<div class="container">
    <h2>üìä Baccarat Strategy & Big Road</h2>

    <div class="road-section" id="roadScrollContainer">
        <div class="road-title">Big Road</div>
        <div id="bigRoadGrid" class="big-road-grid"></div>
    </div>

    <div class="last-result-box" id="last-result-display">Last: -</div>

    <div id="next-bet-display" class="next-bet-box">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô - NO BET</div>

    <div class="stat-box">
        <div class="stat-item">Profit: <span id="stat-profit">0.00</span></div>
        <div class="stat-item">Last P/L: <span id="stat-last-pl">0.00</span></div>
        <div class="stat-item">Max Bet: <span id="stat-maxbet">0.00</span></div>
        <div class="stat-item">Mode: <span id="stat-mode">WAITING</span></div>
    </div>

    <div class="btn-group">
        <button class="btn-p" onclick="processResult('P')">P</button>
        <button class="btn-b" onclick="processResult('B')">B</button>
        <button class="btn-t" onclick="processResult('T')">T</button>
    </div>
    <div class="btn-group">
        <button class="btn-back" onclick="undoLast()">BACK (‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö)</button>
        <button class="btn-reset" onclick="resetAll()">RESET ALL</button>
    </div>

    <div class="grid">
        <div class="card">
            <label>‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ (Min Bet):</label>
            <input type="number" id="unitSize" value="10.0" step="0.1">
            <label>‡∏ä‡∏¥‡∏õ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡πÉ‡∏ô‡∏Ñ‡∏≤‡∏™‡∏¥‡πÇ‡∏ô (Minimum Chip):</label>
            <select id="chipSize" onchange="updateUI()">
                <option value="0.1">0.1</option>
                <option value="1" selected>1</option>
                <option value="5">5</option>
                <option value="10">10</option>
                <option value="50">50</option>
                <option value="100">100</option>
            </select>
        </div>
        <div class="card">
            <label>‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏µ‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (Stop Loss):</label>
            <input type="number" id="stopLoss" value="1000000.0">
            <label>‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏à‡∏≤‡∏Å‡∏¢‡∏≠‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô (Rebate Rate)(0.01 = 1%):</label>
            <input type="number" id="rebateRate" value="0.01" step="0.001">
            <input type="hidden" id="vLossTrigger" value="1">
        </div>
    </div>

    <div id="log-area">--- Ready ---</div>
</div>

<script>
/** Logic & State **/
let history = [];
let globalState = {
    totalAccumulatedProfit: 0, currentSessionBR: 0, currentSessionTarget: 0,
    consecutiveVirtualLosses: 0, totalRealSessions: 0, overallMaxBet: 0,
    bankroll: 0, peakBankroll: 0, state: "FLAT", martyStep: 0, fiboIdx: 0,
    handCount: 0, hasLostSincePeak: false, initialBRInSession: 0,
    lastPL: 0 // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏¢‡∏≠‡∏î‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
};
let stateHistory = [];

const SETTINGS = {
    side: "PLAYER",
    initBR: 20.0,
    baseInc: 0.01,
    martyMult: 2.0,
    fiboMult: 1000000.0
};

function getFibo(n) {
    if (n <= 0) return 1;
    if (n === 1) return 1;
    let a = 1, b = 1;
    for (let i = 2; i <= n; i++) {
        let temp = b; b = a + b; a = temp;
    }
    return b;
}

function getConfig() {
    return {
        unitSize: parseFloat(document.getElementById('unitSize').value),
        martyMult: SETTINGS.martyMult,
        fiboMult: SETTINGS.fiboMult,
        stopLoss: parseFloat(document.getElementById('stopLoss').value),
        initBR: SETTINGS.initBR,
        vLossTrigger: parseInt(document.getElementById('vLossTrigger').value),
        rebateRate: parseFloat(document.getElementById('rebateRate').value),
        baseInc: SETTINGS.baseInc,
        side: SETTINGS.side,
        chipSize: parseFloat(document.getElementById('chipSize').value)
    };
}

function saveState() {
    stateHistory.push(JSON.parse(JSON.stringify({ state: globalState, history: history })));
}

function undoLast() {
    if (stateHistory.length === 0) return;
    const last = stateHistory.pop();
    globalState = last.state;
    history = last.history;
    updateUI();
    document.getElementById('log-area').prepend(document.createElement('div')).innerText = "‚Ü∫ Undo Last Action";
}

function initSession() {
    const config = getConfig();
    if (globalState.handCount === 0) {
        if (globalState.totalRealSessions === 0 && globalState.totalAccumulatedProfit === 0) {
            globalState.currentSessionBR = config.initBR;
            globalState.currentSessionTarget = config.baseInc;
        }
        globalState.bankroll = globalState.currentSessionBR;
        globalState.initialBRInSession = globalState.currentSessionBR;
        globalState.peakBankroll = globalState.currentSessionBR;
        globalState.state = "FLAT";
        globalState.martyStep = 0;
        globalState.fiboIdx = 0;
        globalState.hasLostSincePeak = false;
    }
}

function calculateNextBet() {
    if (globalState.handCount === 0 && globalState.totalRealSessions === 0 && globalState.totalAccumulatedProfit === 0) return null;
    initSession();
    const config = getConfig();
    let currentDrawdown = globalState.peakBankroll - globalState.bankroll;
    let bet = 0;
    
    if (globalState.state === "FLAT") {
        bet = (currentDrawdown > 0 && globalState.hasLostSincePeak) ? Math.max(Math.ceil(currentDrawdown / 4), config.unitSize) : config.unitSize;
    } else if (globalState.state === "MARTY") {
        bet = config.unitSize * Math.pow(config.martyMult, globalState.martyStep);
    } else if (globalState.state === "FIBO") {
        bet = getFibo(globalState.fiboIdx) * config.fiboMult;
    }
    
    let neededToRecover = currentDrawdown + config.unitSize;
    if (globalState.state !== "FLAT") bet = Math.min(bet, neededToRecover);
    if (bet >= config.stopLoss) bet = config.stopLoss;
    
    let currentProfitThisSession = globalState.bankroll - globalState.initialBRInSession;
    let remainingToTarget = globalState.currentSessionTarget - currentProfitThisSession;
    if (bet > remainingToTarget && remainingToTarget > 0) bet = Math.max(config.unitSize, remainingToTarget);
    
    const cs = config.chipSize;
    let roundedBet = Math.ceil(bet / cs) * cs;
    
    if (cs === 0.1) {
        roundedBet = parseFloat(roundedBet.toFixed(1));
    }
    
    return roundedBet;
}

function processResult(actualResult) {
    saveState();
    initSession();
    const config = getConfig();
    const isVirtual = globalState.consecutiveVirtualLosses < config.vLossTrigger;
    if (actualResult === 'T') { history.push('T'); updateUI(); return; }
    
    let bet = calculateNextBet() || config.unitSize;
    if (bet > globalState.overallMaxBet) globalState.overallMaxBet = bet;
    
    const isWin = (actualResult === 'P' && config.side === 'PLAYER') || (actualResult === 'B' && config.side === 'BANKER');
    const payout = (config.side === 'BANKER') ? 0.95 : 1.0;
    
    let currentHandPL = (bet * config.rebateRate); // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡πà‡∏≤ Rebate
    globalState.bankroll += (bet * config.rebateRate);
    globalState.handCount++;
    history.push(actualResult);
    
    if (isWin) {
        const winAmount = (bet * payout);
        globalState.bankroll += winAmount;
        currentHandPL += winAmount; // ‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î‡∏ä‡∏ô‡∏∞
        if (globalState.state === "FIBO") {
            globalState.fiboIdx = Math.max(-1, globalState.fiboIdx - 2);
            if (globalState.fiboIdx < 0) { globalState.state = "FLAT"; globalState.fiboIdx = 0; }
        } else {
            if (globalState.bankroll >= globalState.peakBankroll) globalState.hasLostSincePeak = false;
            globalState.state = "FLAT"; globalState.martyStep = 0;
        }
    } else {
        globalState.bankroll -= bet;
        currentHandPL -= bet; // ‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î‡πÄ‡∏™‡∏µ‡∏¢
        globalState.hasLostSincePeak = true;
        if (bet >= config.stopLoss) { globalState.state = "FLAT"; globalState.martyStep = 0; globalState.fiboIdx = 0; }
        else {
            if (globalState.state === "FLAT") { globalState.state = "MARTY"; globalState.martyStep = 1; }
            else if (globalState.state === "MARTY") { 
                globalState.martyStep++; 
                if (globalState.martyStep > 12) { globalState.state = "FIBO"; globalState.fiboIdx = 0; }
            }
            else if (globalState.state === "FIBO") { globalState.fiboIdx++; }
        }
    }
    
    globalState.lastPL = currentHandPL; // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    if (globalState.bankroll > globalState.peakBankroll) globalState.peakBankroll = globalState.bankroll;
    
    if (globalState.bankroll <= 0 || (globalState.bankroll - globalState.initialBRInSession) >= globalState.currentSessionTarget) {
        const sessionProfit = globalState.bankroll - globalState.initialBRInSession;
        if (isVirtual) { globalState.consecutiveVirtualLosses = (globalState.bankroll <= 0) ? globalState.consecutiveVirtualLosses + 1 : 0; }
        else {
            globalState.totalAccumulatedProfit += sessionProfit;
            globalState.totalRealSessions++;
            if (globalState.bankroll > 0) {
                globalState.currentSessionTarget = config.baseInc;
                globalState.currentSessionBR = config.initBR + globalState.totalAccumulatedProfit;
            } else {
                globalState.currentSessionTarget = Math.abs(globalState.totalAccumulatedProfit) + config.baseInc;
                globalState.currentSessionBR = globalState.currentSessionTarget * 1.5;
            }
            globalState.consecutiveVirtualLosses = 0;
        }
        globalState.handCount = 0;
    }
    updateUI();
}

function renderBigRoad() {
    const bigRoadGrid = document.getElementById('bigRoadGrid');
    bigRoadGrid.innerHTML = '';
    let matrix = [];
    let col = 0, row = 0;
    let lastResult = null;

    history.forEach(res => {
        if (res === 'T') return; 

        if (!lastResult) {
            matrix[0] = Array(6).fill(null);
            matrix[0][0] = { res: res };
            lastResult = res;
        } else if (res === lastResult) {
            if (row + 1 < 6 && (!matrix[col] || matrix[col][row + 1] === null)) {
                row++;
            } else {
                col++;
                if (!matrix[col]) matrix[col] = Array(6).fill(null);
            }
            matrix[col][row] = { res: res };
        } else {
            row = 0;
            col++;
            while(matrix[col] && matrix[col][row] !== null) col++; 
            if (!matrix[col]) matrix[col] = Array(6).fill(null);
            matrix[col][row] = { res: res };
            lastResult = res;
        }
    });

    const displayCols = Math.max(30, matrix.length);
    for (let c = 0; c < displayCols; c++) {
        for (let r = 0; r < 6; r++) {
            const cell = document.createElement('div');
            cell.className = 'big-cell';
            if (matrix[c] && matrix[c][r]) {
                const circle = document.createElement('div');
                circle.className = `big-circle ${matrix[c][r].res}`;
                cell.appendChild(circle);
            }
            bigRoadGrid.appendChild(cell);
        }
    }
    const container = document.getElementById('roadScrollContainer');
    container.scrollLeft = container.scrollWidth;
}

function updateUI() {
    renderBigRoad();
    const config = getConfig();
    const nextBetAmount = calculateNextBet();
    const nextBetEl = document.getElementById('next-bet-display');
    const statusEl = document.getElementById('stat-mode');
    const lastResEl = document.getElementById('last-result-display');
    
    document.getElementById('stat-profit').innerText = globalState.totalAccumulatedProfit.toFixed(4);
    document.getElementById('stat-maxbet').innerText = globalState.overallMaxBet.toLocaleString();
    
    // ‡πÅ‡∏™‡∏î‡∏á‡∏¢‡∏≠‡∏î P/L ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    const lastPLVal = globalState.lastPL;
    const lastPLEl = document.getElementById('stat-last-pl');
    lastPLEl.innerText = lastPLVal.toFixed(2);
    lastPLEl.style.color = lastPLVal >= 0 ? "#2ecc71" : "#e74c3c";

    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏£‡∏∏‡∏õ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏õ‡∏∏‡πà‡∏°
    if(history.length > 0) {
        const lastSymbol = history[history.length-1];
        const statusText = lastPLVal >= 0 ? "WIN" : "LOSS";
        const colorClass = lastPLVal >= 0 ? "win-text" : "loss-text";
        lastResEl.innerHTML = `Last: <span class="${colorClass}">${lastSymbol} ${statusText} (${lastPLVal.toFixed(2)})</span>`;
    } else {
        lastResEl.innerText = "Last: -";
    }

    if (nextBetAmount === null) {
        nextBetEl.innerText = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô - NO BET";
        nextBetEl.style.background = "#eee"; nextBetEl.style.color = "#333";
        statusEl.innerText = "WAITING";
    } else {
        if (globalState.consecutiveVirtualLosses < config.vLossTrigger) {
            statusEl.innerText = "VIRTUAL WAIT";
            nextBetEl.innerHTML = `üî≠ VIRTUAL: <small>‡∏£‡∏≠‡∏à‡∏ö‡∏ä‡∏∏‡∏î‡∏ô‡∏µ‡πâ</small>`;
            nextBetEl.style.background = "#f1c40f"; nextBetEl.style.color = "#2c3e50";
        } else {
            statusEl.innerText = "REAL BETTING";
            nextBetEl.style.color = "white";
            const sideTxt = config.side;
            nextBetEl.style.background = config.side === 'PLAYER' ? "#3498db" : "#e74c3c";
            
            const formattedBet = config.chipSize === 0.1 ? nextBetAmount.toFixed(1) : nextBetAmount.toLocaleString();
            nextBetEl.innerHTML = `üî• REAL BET: ${sideTxt} (${formattedBet})`;
        }
    }
}

function resetAll() {
    if(!confirm("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) return;
    history = []; stateHistory = [];
    globalState = {
        totalAccumulatedProfit: 0, currentSessionBR: 0, currentSessionTarget: 0,
        consecutiveVirtualLosses: 0, totalRealSessions: 0, overallMaxBet: 0,
        bankroll: 0, peakBankroll: 0, state: "FLAT", martyStep: 0, fiboIdx: 0,
        handCount: 0, hasLostSincePeak: false, initialBRInSession: 0,
        lastPL: 0
    };
    updateUI();
}
</script>
</body>
</html>
