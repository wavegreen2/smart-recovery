<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baccarat Recovery System Pro</title>
    <style>
        :root { --p-color: #007bff; --b-color: #dc3545; --t-color: #28a745; }
        body { font-family: 'Inter', sans-serif; background: #1a1a1a; color: #fff; margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: auto; }
        .grid-layout { display: grid; grid-template-columns: 350px 1fr; gap: 20px; }
        
        /* Dashboard & Config */
        .card { background: #2d2d2d; border-radius: 10px; padding: 20px; margin-bottom: 20px; border: 1px solid #444; }
        h3 { margin-top: 0; border-bottom: 1px solid #444; padding-bottom: 10px; font-size: 1.1em; color: #ffca28; }
        
        /* Big Road */
        .road-container { background: #fff; border: 2px solid #555; height: 180px; display: grid; 
            grid-template-columns: repeat(40, 1fr); grid-template-rows: repeat(6, 1fr); 
            gap: 1px; overflow-x: auto; margin-bottom: 20px; }
        .road-cell { background: #fff; border: 1px solid #eee; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px; }
        .cell-P { color: var(--p-color); } .cell-B { color: var(--b-color); } .cell-T { color: var(--t-color); }

        /* Betting Banner */
        .bet-banner { display: flex; justify-content: space-between; align-items: center; padding: 20px; border-radius: 8px; margin-bottom: 20px; font-size: 1.5em; font-weight: bold; border: 2px solid #fff; }
        .bet-P { background: var(--p-color); } .bet-B { background: var(--b-color); } .bet-WAIT { background: #555; }

        /* Form Controls */
        label { display: block; margin: 8px 0 4px; font-size: 0.85em; color: #bbb; }
        input, select { width: 100%; padding: 8px; background: #3d3d3d; border: 1px solid #555; color: #fff; border-radius: 4px; margin-bottom: 10px; }
        .btn { cursor: pointer; border: none; border-radius: 5px; font-weight: bold; transition: 0.2s; padding: 10px; }
        .btn-start { background: #28a745; color: white; width: 100%; font-size: 1.1em; }
        .btn-manual { flex: 1; height: 60px; font-size: 1.2em; color: white; }
        
        /* Stats Table */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .stat-box { background: #3d3d3d; padding: 15px; border-radius: 8px; text-align: center; }
        .stat-val { font-size: 1.4em; font-weight: bold; display: block; }
        .profit-plus { color: #28a745; } .profit-minus { color: #ff4444; }

        .logs { background: #000; height: 250px; overflow-y: auto; font-family: monospace; padding: 10px; border-radius: 5px; font-size: 12px; color: #0f0; }
    </style>
</head>
<body>

<div class="container">
    <div class="grid-layout">
        <div class="sidebar">
            <div class="card">
                <h3>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö (Settings)</h3>
                <label>‡πÇ‡∏´‡∏°‡∏î (Mode):</label>
                <select id="mode" onchange="toggleManualBox()">
                    <option value="m">Manual Input (‡∏Å‡∏î‡∏°‡∏∑‡∏≠)</option>
                    <option value="r">Random Simulation (‡∏™‡∏∏‡πà‡∏°)</option>
                    <option value="a">Auto Data (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö)</option>
                </select>

                <label>‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏ù‡∏±‡πà‡∏á (Side Preference):</label>
                <select id="side_preference">
                    <option value="PLAYER">PLAYER</option>
                    <option value="BANKER">BANKER</option>
                </select>

                <label>‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ (Min Bet):</label>
                <input type="number" id="unit_size" value="10">

                <label>‡∏ä‡∏¥‡∏õ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ (Min Chip):</label>
                <input type="number" id="min_chip" value="5">

                <label>‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô % (Commission 1%):</label>
                <input type="number" id="rebate_rate" value="1" step="0.1">

                <label>‡∏¢‡∏≠‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (Stop Loss):</label>
                <input type="number" id="stop_loss_threshold" value="300000">

                <label>‡∏£‡∏≠‡∏ú‡∏•‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏•‡∏≠‡∏Å (Virtual Loss Trigger):</label>
                <input type="number" id="virtual_loss_trigger" value="2">

                <hr style="border:0.5px solid #444">
                <label>Marty Multiplier:</label>
                <input type="number" id="marty_mult" value="2">
                <label>Fibo Multiplier:</label>
                <input type="number" id="fibo_mult" value="10">

                <button class="btn btn-start" onclick="startSimulation()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö (START)</button>
            </div>
        </div>

        <div class="main-panel">
            <div class="road-container" id="big_road"></div>

            <div id="bet_banner" class="bet-banner bet-WAIT">
                <span id="next_side">‡∏£‡∏≠‡∏£‡∏∞‡∏ö‡∏ö (WAITING)</span>
                <span id="next_amount">0.00</span>
            </div>

            <div class="stats-grid">
                <div class="stat-box">
                    <span style="color:#bbb">‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (Net Profit)</span>
                    <span id="stat_net_profit" class="stat-val profit-plus">0.00</span>
                </div>
                <div class="stat-box">
                    <span style="color:#bbb">‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô‡∏™‡∏∞‡∏™‡∏° (Total Commission)</span>
                    <span id="stat_commission" class="stat-val" style="color:#2ecc71">0.00</span>
                </div>
                <div class="stat-box">
                    <span style="color:#bbb">‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (Max Bet)</span>
                    <span id="stat_max_bet" class="stat-val">0.00</span>
                </div>
                <div class="stat-box">
                    <span style="color:#bbb">Session ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</span>
                    <span id="stat_session" class="stat-val">0</span>
                </div>
            </div>

            <div class="card" id="manual_input_box">
                <h3>üéÆ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏°‡∏∑‡∏≠ (Manual Input)</h3>
                <div style="display:flex; gap:10px;">
                    <button class="btn btn-manual" style="background:var(--p-color)" onclick="handleManual('P')">PLAYER (P)</button>
                    <button class="btn btn-manual" style="background:var(--b-color)" onclick="handleManual('B')">BANKER (B)</button>
                    <button class="btn btn-manual" style="background:var(--t-color)" onclick="handleManual('T')">TIE (T)</button>
                </div>
            </div>

            <div class="logs" id="log_output">LOG: ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô...</div>
        </div>
    </div>
</div>

<script>
    // --- Logic Variables (Same as Python Original) ---
    let state = {
        total_net_profit: 0,
        total_commission: 0,
        total_real_sessions: 0,
        consecutive_virtual_losses: 0,
        total_loss_accumulated: 0,
        current_target: 0.01,
        base_bankroll: 1000000, // Dummy high BR for simulation
        
        // Session State
        session_active: false,
        s_bankroll: 0,
        s_peak: 0,
        s_state: "FLAT",
        s_marty_step: 0,
        s_fibo_idx: 0,
        s_has_lost: false,
        max_bet: 0,
        
        road_data: []
    };

    function getFibo(n) {
        if (n <= 0) return 1;
        if (n === 1) return 1;
        let a = 1, b = 1;
        for (let i = 2; i <= n; i++) { let tmp = a + b; a = b; b = tmp; }
        return b;
    }

    function toggleManualBox() {
        const m = document.getElementById('mode').value;
        document.getElementById('manual_input_box').style.visibility = (m === 'm' ? 'visible' : 'hidden');
    }

    function updateUI() {
        document.getElementById('stat_net_profit').innerText = state.total_net_profit.toLocaleString(undefined, {minimumFractionDigits: 2});
        document.getElementById('stat_net_profit').className = 'stat-val ' + (state.total_net_profit >= 0 ? 'profit-plus' : 'profit-minus');
        document.getElementById('stat_commission').innerText = state.total_commission.toLocaleString(undefined, {minimumFractionDigits: 2});
        document.getElementById('stat_max_bet').innerText = state.max_bet.toLocaleString();
        document.getElementById('stat_session').innerText = state.total_real_sessions;
        
        // Update Advice Banner
        if (state.session_active) {
            const bet = calculateBet();
            const trigger = parseInt(document.getElementById('virtual_loss_trigger').value);
            const isVirtual = state.consecutive_virtual_losses < trigger;

            if (isVirtual) {
                document.getElementById('bet_banner').className = "bet-banner bet-WAIT";
                document.getElementById('next_side').innerText = "VIRTUAL WAIT (‡∏£‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏•‡∏≠‡∏Å)";
                document.getElementById('next_amount').innerText = bet.toFixed(2);
            } else {
                const side = document.getElementById('side_preference').value;
                document.getElementById('bet_banner').className = "bet-banner " + (side === 'PLAYER' ? 'bet-P' : 'bet-B');
                document.getElementById('next_side').innerText = "BET " + side;
                document.getElementById('next_amount').innerText = bet.toFixed(2);
            }
        }
    }

    function drawRoad() {
        const road = document.getElementById('big_road');
        road.innerHTML = '';
        // Simple Big Road Logic (Vertical Stack)
        let columns = [];
        let currentCol = [];
        let lastRes = '';
        
        state.road_data.forEach(res => {
            if (res === 'T') return;
            if (res !== lastRes && lastRes !== '') {
                columns.push(currentCol);
                currentCol = [];
            }
            currentCol.push(res);
            lastRes = res;
        });
        columns.push(currentCol);

        // Render 40 columns
        for (let i = 0; i < 40 * 6; i++) {
            const cell = document.createElement('div');
            cell.className = 'road-cell';
            const colIdx = Math.floor(i / 6);
            const rowIdx = i % 6;
            if (columns[colIdx] && columns[colIdx][rowIdx]) {
                cell.innerText = columns[colIdx][rowIdx];
                cell.className += ' cell-' + columns[colIdx][rowIdx];
            }
            road.appendChild(cell);
        }
    }

    function calculateBet() {
        const unit_size = parseFloat(document.getElementById('unit_size').value);
        const marty_mult = parseFloat(document.getElementById('marty_mult').value);
        const fibo_mult = parseFloat(document.getElementById('fibo_mult').value);
        const min_chip = parseFloat(document.getElementById('min_chip').value);
        const stop_loss = parseFloat(document.getElementById('stop_loss_threshold').value);
        
        let raw_bet = unit_size;
        let drawdown = state.s_peak - state.s_bankroll;

        if (state.s_state === "FLAT") {
            raw_bet = (drawdown > 0 && state.s_has_lost) ? Math.max(Math.ceil(drawdown / 4), unit_size) : unit_size;
        } else if (state.s_state === "MARTY") {
            raw_bet = unit_size * Math.pow(marty_mult, state.s_marty_step);
        } else if (state.s_state === "FIBO") {
            raw_bet = getFibo(state.s_fibo_idx) * fibo_mult;
        }

        let bet = (state.s_state !== "FLAT") ? Math.min(raw_bet, drawdown + unit_size) : raw_bet;
        if (bet >= stop_loss) bet = stop_loss;
        
        // Target Adjust
        let cur_profit = state.s_bankroll - state.base_bankroll;
        let rem = state.current_target - cur_profit;
        if (bet > rem && rem > 0) bet = Math.max(unit_size, rem);

        // Chip size rounding
        return Math.ceil(bet / min_chip) * min_chip;
    }

    function startSimulation() {
        state.total_net_profit = 0;
        state.total_commission = 0;
        state.total_real_sessions = 0;
        state.total_loss_accumulated = 0;
        state.current_target = 0.01;
        state.consecutive_virtual_losses = 0;
        state.road_data = [];
        document.getElementById('log_output').innerHTML = "SYSTEM STARTED...";
        startNewSession();
    }

    function startNewSession() {
        state.session_active = true;
        state.s_bankroll = state.base_bankroll;
        state.s_peak = state.base_bankroll;
        state.s_state = "FLAT";
        state.s_marty_step = 0;
        state.s_fibo_idx = 0;
        state.s_has_lost = false;
        updateUI();
    }

    function handleManual(res) {
        if (!state.session_active) return;
        
        const bet = calculateBet();
        const side_pref = document.getElementById('side_preference').value;
        const comm_rate = parseFloat(document.getElementById('rebate_rate').value) / 100;
        const trigger = parseInt(document.getElementById('virtual_loss_trigger').value);
        const stop_loss = parseFloat(document.getElementById('stop_loss_threshold').value);
        
        const isVirtual = state.consecutive_virtual_losses < trigger;
        const isWin = (res === 'P' && side_pref === 'PLAYER') || (res === 'B' && side_pref === 'BANKER');

        state.road_data.push(res);
        drawRoad();

        if (res === 'T') return;

        // Calc Commission & Win/Loss
        const comm_val = bet * comm_rate;
        state.total_commission += comm_val;
        state.s_bankroll += comm_val;
        if (!isVirtual) state.total_net_profit += comm_val;

        if (isWin) {
            const payout = (side_pref === 'BANKER') ? 0.95 : 1.0;
            const win_amt = bet * payout;
            state.s_bankroll += win_amt;
            if (!isVirtual) state.total_net_profit += win_amt;
            
            if (state.s_state === "FIBO") {
                state.s_fibo_idx = Math.max(-1, state.s_fibo_idx - 2);
                if (state.s_fibo_idx < 0) { state.s_state = "FLAT"; state.s_fibo_idx = 0; }
            } else {
                if (state.s_bankroll >= state.s_peak) state.s_has_lost = false;
                state.s_state = "FLAT"; state.s_marty_step = 0;
            }
        } else {
            state.s_bankroll -= bet;
            if (!isVirtual) state.total_net_profit -= bet;
            state.s_has_lost = true;

            if (bet >= stop_loss) {
                state.s_state = "FLAT"; state.s_marty_step = 0;
            } else {
                if (state.s_state === "FLAT") { state.s_state = "MARTY"; state.s_marty_step = 1; }
                else if (state.s_state === "MARTY") {
                    state.s_marty_step++;
                    if (state.s_marty_step > 12) { state.s_state = "FIBO"; state.s_fibo_idx = 0; }
                } else if (state.s_state === "FIBO") { state.s_fibo_idx++; }
            }
        }

        if (state.s_bankroll > state.s_peak) state.s_peak = state.s_bankroll;
        if (bet > state.max_bet) state.max_bet = bet;

        // Session Over Check
        let current_p = state.s_bankroll - state.base_bankroll;
        if (state.s_bankroll <= (state.base_bankroll - stop_loss) || current_p >= state.current_target) {
            finalizeSession(current_p >= state.current_target ? "WIN" : "BUST", current_p);
        } else {
            updateUI();
        }
    }

    function finalizeSession(status, profit) {
        state.session_active = false;
        const trigger = parseInt(document.getElementById('virtual_loss_trigger').value);
        const isVirtual = state.consecutive_virtual_losses < trigger;

        if (isVirtual) {
            if (status === "BUST") state.consecutive_virtual_losses++;
            else state.consecutive_virtual_losses = 0;
        } else {
            state.total_real_sessions++;
            if (status === "WIN") {
                state.total_loss_accumulated = 0;
                state.current_target = 0.01;
                state.consecutive_virtual_losses = 0;
            } else {
                state.total_loss_accumulated += Math.abs(profit);
                state.current_target = state.total_loss_accumulated + 0.01;
            }
        }
        startNewSession();
    }
</script>
</body>
</html>
