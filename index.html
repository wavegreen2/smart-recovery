function calculateBet() {
        if (!isReal) return 0;
        const unit = parseFloat(document.getElementById('unit_size').value);
        const chip = parseFloat(document.getElementById('chip_size').value);
        const limit = parseFloat(document.getElementById('stop_loss_limit').value);
        
        let bet = 0;
        let baseRecovery = 0;

        // 1. คำนวณหาค่าเฉลี่ยดึงทุนคืน (ไม้แรกของ Session)
        if (globalNet < 0) {
            // สูตร: (ยอดติดลบสะสม + Unit) / 5
            baseRecovery = (Math.abs(globalNet) + unit) / 5;
        } else {
            baseRecovery = unit;
        }

        // 2. ตรรกะการเดินเงินใน Session
        if (consecutiveLoss === 0) {
            // ไม้แรกของ Session หรือเพิ่งชนะไม้ก่อนหน้ามา
            bet = baseRecovery;
        } else {
            // สูตรทบตาม Log: (ยอดเสียสะสมในรอบนี้ + ยอดไม้แรกของรอบ) * 2
            // แล้วหักออกด้วยค่า Unit เพื่อให้ตัวเลขตรง 20->35, 190->375
            bet = (sessionLoss + baseRecovery) * 2 - baseRecovery;
            
            // กรณีไม้ 5-10-20-40 (Double ปกติเมื่อกำไรเป็นบวก)
            if (globalNet >= 0) {
                bet = baseRecovery * Math.pow(2, consecutiveLoss);
            }
        }

        // 3. เช็คไม้ปิดยอด (TargetToWin)
        let targetToWin = (globalNet < 0 ? Math.abs(globalNet) : 0) + unit;
        
        // ถ้าเบทที่คำนวณได้สูงกว่ายอดที่ต้องการเพื่อกลับมาบวก Unit ให้ลดลงมาพอดี
        if (bet > targetToWin && globalNet < 0) {
            bet = targetToWin;
        }

        // 4. การจัดการเศษชิป (สำคัญมาก)
        // ถ้าเป็นไม้ปิดยอด (มีทศนิยม เช่น 745.8) ห้ามปัดเศษตาม Log เป๊ะๆ
        // ถ้าไม่ใช่ไม้ปิดยอด ให้ปัดเศษขึ้นตามค่า Chip Size
        if (bet !== targetToWin) {
            bet = Math.ceil(bet / chip) * chip;
        }

        // คุมยอดไม่ให้ต่ำกว่า Unit และไม่เกิน Max Limit
        if (bet < unit) bet = unit;
        return bet > limit ? limit : bet;
    }
