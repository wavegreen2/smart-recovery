<!DOCTYPE html>
  <html lang="th">
  <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
      <title>Baccarat AI: Fixed Dragon Road</title>
      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      <style>
          :root {
              --primary: #2c3e50;
              --accent: #16a085;
              --player: #2980b9;
              --banker: #c0392b;
              --tie: #27ae60;
              --bg: #ecf0f1;
              --card-bg: #ffffff;
              --text: #2c3e50;
              --gray-light: #f8f9fa;
              --success: #2ecc71;
              --warning: #f39c12;
              --danger: #e74c3c;
          }
  
          body {
              font-family: 'Segoe UI', 'Sarabun', Roboto, sans-serif;
              background-color: var(--bg);
              color: var(--text);
              margin: 0;
              padding: 10px;
              display: flex;
              justify-content: center;
              height: 100vh;
              overflow: hidden; 
          }
  
          .container {
              width: 100%;
              max-width: 1200px;
              display: grid;
              grid-template-columns: 320px 1fr;
              gap: 15px;
              height: 95vh;
          }
  
          /* --- SIDEBAR --- */
          .sidebar {
              background: var(--card-bg);
              padding: 15px;
              border-radius: 12px;
              box-shadow: 0 4px 15px rgba(0,0,0,0.05);
              overflow-y: auto;
              display: flex;
              flex-direction: column;
              gap: 10px;
              height: 100%;
          }
  
          .section-title { 
              font-size: 0.85rem; font-weight: bold; color: var(--accent); 
              margin-top: 5px; border-bottom: 1px dashed #bdc3c7; padding-bottom: 3px; 
          }
  
          .form-group { margin-bottom: 5px; }
          .form-group label { display: block; font-size: 0.8rem; font-weight: 600; margin-bottom: 2px; color: #555; }
          .form-group input { width: 100%; padding: 8px; border: 1px solid #bdc3c7; border-radius: 5px; font-size: 0.95rem; box-sizing: border-box; }
          
          .monitor-box {
              background: #e8f8f5;
              border: 1px solid #d1f2eb;
              border-radius: 8px;
              padding: 10px;
              margin-bottom: 5px;
              text-align: center;
          }
          .monitor-label { font-size: 0.75rem; color: #7f8c8d; font-weight: 600; display: block; margin-bottom: 2px; }
          .monitor-val { font-size: 1rem; font-weight: bold; color: var(--accent); }
          
          .status-done {
              color: white;
              background-color: var(--success);
              padding: 4px 10px;
              border-radius: 20px;
              display: inline-block;
              font-size: 0.9rem;
              margin-bottom: 5px;
          }
  
          /* WARNING FLASH */
          .warn-flash {
              color: var(--danger);
              font-weight: bold;
              font-size: 0.85rem;
              animation: flashText 1s infinite;
              margin-top: 5px;
              line-height: 1.2;
              border-top: 1px dashed rgba(231, 76, 60, 0.3);
              padding-top: 5px;
          }
  
          @keyframes pulse {
              0% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.4); }
              70% { box-shadow: 0 0 0 10px rgba(46, 204, 113, 0); }
              100% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0); }
          }
  
          .brain-monitor {
              background: var(--gray-light);
              border: 1px solid #e0e0e0;
              border-radius: 8px;
              padding: 8px;
              display: grid;
              grid-template-columns: 1fr 1fr;
              gap: 5px;
          }
          .brain-col { text-align: center; }
          .brain-head { font-size: 0.7rem; font-weight: bold; margin-bottom: 2px; }
          .brain-val { font-size: 1.1rem; font-weight: 800; }
          .brain-info { font-size: 0.65rem; color: #7f8c8d; }
          .txt-p { color: var(--player); }
          .txt-b { color: var(--banker); }
  
          .btn-action {
              width: 100%; padding: 12px; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 0.9rem; margin-top: 5px;
          }
          .btn-sim { background: var(--accent); }
          .btn-import { background: #34495e; margin-top: 5px; }
          .btn-reset { background: #95a5a6; margin-top: 10px; }
  
          /* --- MAIN CONTENT --- */
          .main-content { 
              display: flex; 
              flex-direction: column; 
              gap: 15px; 
              overflow-y: auto; 
              padding-right: 5px;
              height: 100%;
          }
  
          .stats-grid {
              display: grid; 
              grid-template-columns: repeat(3, 1fr); 
              gap: 10px; flex-shrink: 0;
          }
          .stat-card {
              background: var(--card-bg); padding: 10px; border-radius: 10px; text-align: center;
              box-shadow: 0 2px 10px rgba(0,0,0,0.03); border-top: 4px solid transparent;
          }
          .stat-card.profit { border-top-color: var(--tie); }
          .stat-card.loss { border-top-color: var(--banker); }
          .stat-card.pre { border-top-color: var(--warning); background: #fffcf5; }
          
          .stat-label { font-size: 0.65rem; color: #95a5a6; text-transform: uppercase; line-height: 1.2; }
          .stat-value { font-size: 1rem; font-weight: 800; margin-top: 3px; }
  
          /* --- BIG ROAD STYLE --- */
          .road-scroll-wrapper {
              background: var(--card-bg);
              padding: 10px;
              border-radius: 10px;
              box-shadow: inset 0 0 10px rgba(0,0,0,0.02);
              overflow-x: auto;
              overflow-y: hidden;
              height: 170px; 
              min-height: 170px;
              flex-shrink: 0; 
              -webkit-overflow-scrolling: touch;
              width: 100%;
              box-sizing: border-box;
          }
          
          .big-road-grid {
              display: grid;
              grid-template-rows: repeat(6, 26px); 
              grid-auto-columns: 26px; 
              grid-auto-flow: column;
              gap: 1px;
              min-width: 100%;
          }
  
          .big-road-cell {
              width: 24px; height: 24px;
              display: flex; justify-content: center; align-items: center;
              font-size: 10px; font-weight: bold;
              border: 1px solid #f0f0f0;
              background: white;
          }
  
          .circle {
              width: 18px; height: 18px;
              border-radius: 50%;
              border: 2px solid transparent;
              display: flex; justify-content: center; align-items: center;
              background: transparent;
          }
          .circle-P { border-color: var(--player); color: var(--player); }
          .circle-B { border-color: var(--banker); color: var(--banker); }
          .circle-T { border-color: var(--tie); color: var(--tie); }
  
          /* Bet Panel */
          .bet-panel {
              background: var(--card-bg); padding: 15px; border-radius: 12px; text-align: center;
              box-shadow: 0 5px 20px rgba(0,0,0,0.08); flex-shrink: 0;
          }
          .offset-formula {
              font-family: monospace; font-size: 0.9rem; color: #7f8c8d; background: #f0f3f4;
              padding: 4px 10px; border-radius: 4px; display: inline-block; margin-bottom: 10px;
          }
          .rec-amount { font-size: 3rem; font-weight: 900; line-height: 1; color: var(--primary); }
          .rec-side { font-size: 1.5rem; font-weight: 800; margin-top: 5px; }
          .side-p { color: var(--player); }
          .side-b { color: var(--banker); }
          .side-n { color: #95a5a6; }
          .reduced-tag { font-size: 0.8rem; color: var(--success); font-weight: bold; display: none; margin-top: 5px; }
  
          .controls { display: grid; grid-template-columns: 1fr 1fr 80px; gap: 10px; margin-top: 15px; }
          .btn-ctrl { padding: 15px; border: none; border-radius: 8px; font-size: 1rem; font-weight: bold; cursor: pointer; color: white; touch-action: manipulation; }
          .btn-p { background: var(--player); }
          .btn-b { background: var(--banker); }
          .btn-u { background: #95a5a6; }
  
          /* Chart */
          .chart-box {
              background: var(--card-bg); padding: 10px; border-radius: 12px;
              box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
              flex-grow: 1; 
              min-height: 250px;
              position: relative;
          }
  
          .modal-overlay {
              position: fixed; top: 0; left: 0; width: 100%; height: 100%;
              background: rgba(0,0,0,0.6); 
              display: none; 
              justify-content: center; align-items: center; 
              z-index: 999999; 
              backdrop-filter: blur(3px);
          }
          .modal-box {
              background: white; 
              padding: 30px 20px; 
              border-radius: 15px; 
              text-align: center; 
              max-width: 400px; 
              width: 85%;
              box-shadow: 0 20px 50px rgba(0,0,0,0.3);
              display: flex; flex-direction: column; align-items: center;
          }
          
          .modal-icon { font-size: 4rem; margin-bottom: 15px; }
          .modal-text-th { font-size: 1.1rem; font-weight: bold; color: #2c3e50; margin-bottom: 5px; }
          .modal-email { font-size: 1.1rem; font-weight: bold; color: #2c3e50; margin-bottom: 10px; }
          .modal-text-en { font-size: 0.95rem; color: #7f8c8d; margin-bottom: 20px; }
  
          @keyframes flashText {
              0% { opacity: 1; }
              50% { opacity: 0.3; }
              100% { opacity: 1; }
          }
          .modal-reset-th { font-size: 1.1rem; color: var(--danger); font-weight: bold; margin-bottom: 2px; animation: flashText 1s infinite; }
          .modal-reset-en { font-size: 0.9rem; color: var(--danger); margin-bottom: 25px; animation: flashText 1s infinite; }
          
          .btn-modal-ack { background: #27ae60; color: white; border: none; padding: 12px 20px; width: 100%; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1rem; }
  
          @media (max-width: 768px) {
              body { overflow-y: auto; height: auto; display: block; }
              .container { grid-template-columns: 1fr; height: auto; display: flex; flex-direction: column; gap: 20px; padding-bottom: 30px; overflow: visible; }
              .sidebar { height: auto; margin-bottom: 0; flex-shrink: 0; }
              .main-content { height: auto; overflow: visible; }
              .road-scroll-wrapper { min-height: 170px; width: 100%; }
              .stats-grid { grid-template-columns: repeat(2, 1fr); }
              .chart-box { min-height: 300px; }
          }
      </style>
  </head>
  <body>
  
  <div class="container">
      <div class="sidebar">
          <div class="section-title">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ (Settings)</div>
          <div class="form-group">
              <label>‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏∏‡∏ô (Bankroll)</label>
              <input type="number" id="init_bank" value="500000">
          </div>
          
          <div class="form-group" style="display:none;">
              <label>Divisor (‡∏ï‡∏±‡∏ß‡∏´‡∏≤‡∏£)</label>
              <input type="number" id="divisor_val" value="3.01" step="0.01">
          </div>
  
          <!-- SPLIT SETTINGS HERE -->
          <div class="form-group">
              <label>‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ (Min Bet / Unit)</label>
              <input type="number" id="min_bet" value="5">
          </div>
          <div class="form-group">
              <label>‡∏ä‡∏¥‡∏õ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ (Chip Size)</label>
              <input type="number" id="chip_size" value="5">
          </div>
  
          <div class="section-title">üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (Target)</div>
          <div class="monitor-box">
              <span class="monitor-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≥‡πÑ‡∏£ (Status)</span>
              <div id="target_status_display" class="monitor-val">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...</div>
              <div style="font-size:0.6rem; color:#999; margin-top:2px;">Target: MinBet + 0.01 (Strict)</div>
          </div>
  
          <div class="section-title">üß† AI Brain Monitor (Internal)</div>
          <div class="brain-monitor">
              <div class="brain-col">
                  <div class="brain-head txt-p">PLAYER AI</div>
                  <div class="brain-val txt-p" id="mon_p_req">0</div>
                  <div class="brain-info" id="mon_p_info">Wait: 0</div>
              </div>
              <div class="brain-col">
                  <div class="brain-head txt-b">BANKER AI</div>
                  <div class="brain-val txt-b" id="mon_b_req">0</div>
                  <div class="brain-info" id="mon_b_info">Wait: 0</div>
              </div>
          </div>
          <div style="font-size: 0.7rem; color: #999; text-align: center; margin-top: 3px;">
              *Strict Mode: Cap at Target
          </div>
  
          <button class="btn-reset" onclick="resetAll()">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï (RESET)</button>
  
          <div class="section-title">üß™ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ (Tools)</div>
          <div class="form-group">
              <input type="number" id="sim_hands" value="1" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡∏≤ (Hands)">
              <button class="btn-action btn-sim" onclick="runSimulation()">‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏ú‡∏• (Simulate)</button>
              <button class="btn-action btn-import" onclick="importLogs()">üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Import Logs)</button>
          </div>
      </div>
  
      <div class="main-content">
          <div class="stats-grid">
              <div class="stat-card profit">
                  <div class="stat-label">‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (Net Profit)</div>
                  <div class="stat-value" id="disp_net">0</div>
              </div>
              <div class="stat-card">
                  <div class="stat-label">Max Drawdown</div>
                  <div class="stat-value" id="disp_dd">0</div>
              </div>
              <div class="stat-card loss">
                  <div class="stat-label">Max Bet (Real)</div>
                  <div class="stat-value" id="disp_maxbet">0</div>
              </div>
              <div class="stat-card">
                  <div class="stat-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏∑‡∏≠ (Hands)</div>
                  <div class="stat-value" id="disp_hands">0</div>
              </div>
              
              <div class="stat-card pre">
                  <div class="stat-label">‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏õ‡πâ‡∏≤<br>(Pre-Target DD)</div>
                  <div class="stat-value" id="disp_dd_pre">0</div>
              </div>
              <div class="stat-card pre">
                  <div class="stat-label">‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏õ‡πâ‡∏≤<br>(Pre-Target MaxBet)</div>
                  <div class="stat-value" id="disp_bet_pre">0</div>
              </div>
          </div>
  
          <div class="road-scroll-wrapper">
              <div class="big-road-grid" id="road_container"></div>
          </div>
  
          <div class="bet-panel">
              <div class="offset-formula" id="formula_disp">P(0) - B(0) = 0</div>
              
              <div class="rec-amount" id="rec_amount">0</div>
              <div class="rec-side side-n" id="rec_side">NO BET</div>
              <div class="reduced-tag" id="reduced_tag">‚ú® Reduced to Exact Target</div>
              
              <div class="controls">
                  <button class="btn-ctrl btn-p" onclick="processResult('P')">PLAYER</button>
                  <button class="btn-ctrl btn-b" onclick="processResult('B')">BANKER</button>
                  <button class="btn-ctrl btn-u" onclick="undo()">UNDO</button>
              </div>
          </div>
  
          <div class="chart-box">
              <canvas id="profitChart"></canvas>
          </div>
      </div>
  </div>
  
  <div class="modal-overlay" id="winModal">
      <div class="modal-box">
          <div class="modal-icon">üéâ</div>
          <div class="modal-text-th">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (MinBet + 0.01)<br>‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß‡πÄ‡∏à‡πâ‡∏≤‡∏°‡∏∑‡∏≠‡∏ä‡∏ô‡∏∞‡πÄ‡∏™‡∏°‡∏≠</div>
          <div class="modal-email">wavegreen2@gmail.com</div>
          <div class="modal-text-en">Target Hit. The house always wins in the long run.</div>
          <div class="modal-reset-th">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏∞‡∏ö‡∏ö</div>
          <div class="modal-reset-en">Recommend System Reset</div>
          <button class="btn-modal-ack" onclick="closeWinModal()">‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß (Acknowledge)</button>
      </div>
  </div>
  
  <script>
      let state = {
          realBalance: 0,
          history: [],
          maxDrawdown: 0,
          maxBet: 0,
          firstTargetHit: false,
          preTargetDD: 0,
          preTargetMaxBet: 0,
          targetReached: false,
          pStrat: { bal: 0, wait: 0, stage: 0, initBet: 0 },
          bStrat: { bal: 0, wait: 0, stage: 0, initBet: 0 },
          graphData: [0],
          graphLabels: [0]
      };
      
      let undoStack = [];
      let chartInstance = null;
  
      function getRawBet(strat, side) {
          const divisor = parseFloat(document.getElementById('divisor_val').value);
          const minBet = parseFloat(document.getElementById('min_bet').value);
          const chip = parseFloat(document.getElementById('chip_size').value);
          const WAIT_TARGET = 1; 
  
          let bet = 0;
  
          if (strat.stage === 1) {
              if (side === 'P') bet = strat.initBet * 2;
              else bet = Math.floor(strat.initBet * 1.95); 
              if (chip > 0) bet = Math.ceil(bet / chip) * chip;
          } 
          else if (strat.wait >= WAIT_TARGET) {
              let needed = Math.abs(strat.bal) + minBet; 
              let adjustedDivisor = (side === 'B') ? (divisor * 0.95) : divisor;
              let raw = Math.ceil(needed / adjustedDivisor);
              if (chip > 0) raw = Math.ceil(raw / chip) * chip;
              if (raw < minBet) raw = minBet;
              bet = raw;
          }
          return bet;
      }
  
      function updateAI(strat, side, isPWin, rawBet) {
          const isWin = (side === 'P' && isPWin) || (side === 'B' && !isPWin);
          if (isWin) {
              strat.wait++;
              if (strat.stage === 1) {
                  let profit = (side === 'P') ? (strat.initBet * 3) : (strat.initBet * 0.95 + strat.initBet * 1.95 * 0.95);
                  strat.bal += profit;
                  strat.stage = 0;
              } else if (rawBet > 0) {
                  strat.initBet = rawBet;
                  strat.stage = 1;
              }
          } else {
              strat.wait = 0;
              if (rawBet > 0) {
                  strat.bal -= rawBet; 
                  strat.stage = 0;
              }
          }
      }
  
      function processResult(res, isSim = false) {
          if (!isSim) saveState();
  
          const isPWin = (res === 'P');
          const unit = parseFloat(document.getElementById('min_bet').value);
          const chip = parseFloat(document.getElementById('chip_size').value);
          
          const rawP = getRawBet(state.pStrat, 'P');
          const rawB = getRawBet(state.bStrat, 'B');
  
          let netBet = 0;
          let netSide = null;
  
          if (rawP > rawB) {
              netBet = rawP - rawB;
              netSide = 'P';
          } else if (rawB > rawP) {
              netBet = rawB - rawP;
              netSide = 'B';
          }
  
          const reductionCap = unit + 0.01; 
          let gap = reductionCap - state.realBalance;
          
          if (gap > 0 && netBet > 0) {
              let maxAllowed = 0;
              if (netSide === 'P') maxAllowed = gap;
              else maxAllowed = gap / 0.95; 
  
              if (netBet > maxAllowed) {
                  netBet = maxAllowed;
                  if (chip > 0) netBet = Math.ceil(netBet / chip) * chip;
                  if (netBet < unit) netBet = unit; 
              }
          }
  
          if (!state.firstTargetHit && netBet > 0) {
              if (netBet > state.preTargetMaxBet) state.preTargetMaxBet = netBet;
          }
  
          if (netBet > 0) {
              if (netSide === 'P') {
                  if (isPWin) state.realBalance += netBet;
                  else state.realBalance -= netBet;
              } else {
                  if (!isPWin) state.realBalance += (netBet * 0.95);
                  else state.realBalance -= netBet;
              }
          }
  
          updateAI(state.pStrat, 'P', isPWin, rawP);
          updateAI(state.bStrat, 'B', isPWin, rawB);
  
          state.history.push(res);
          state.graphData.push(state.realBalance);
          state.graphLabels.push(state.history.length);
          
          if (state.realBalance < state.maxDrawdown) state.maxDrawdown = state.realBalance;
          if (netBet > state.maxBet) state.maxBet = netBet;
  
          let winTarget = unit + 0.01;
          
          // Logic: Once hit, stays hit
          if (!state.firstTargetHit) {
              if (state.realBalance < state.preTargetDD) state.preTargetDD = state.realBalance;
              if (state.realBalance >= winTarget) state.firstTargetHit = true;
          }
  
          let roundedBal = Math.round(state.realBalance * 100) / 100;
          
          if (!isSim && roundedBal >= winTarget && !state.targetReached) {
              showWinModal();
              state.targetReached = true; 
          }
          if (roundedBal < winTarget) state.targetReached = false;
  
          if (!isSim) updateUI();
      }
  
      function updateUI() {
          const unit = parseFloat(document.getElementById('min_bet').value);
          const chip = parseFloat(document.getElementById('chip_size').value);
          
          const nextP = getRawBet(state.pStrat, 'P');
          const nextB = getRawBet(state.bStrat, 'B');
          
          let netAmt = 0;
          let netSide = "NO BET";
          let formula = `P(${nextP}) - B(${nextB}) = 0`;
          let sideClass = "side-n";
          let isReduced = false;
  
          if (nextP > nextB) {
              netAmt = nextP - nextB;
              netSide = "PLAYER";
              formula = `P(${nextP}) - B(${nextB}) = ${netAmt}`;
              sideClass = "side-p";
          } else if (nextB > nextP) {
              netAmt = nextB - nextP;
              netSide = "BANKER";
              formula = `B(${nextB}) - P(${nextP}) = ${netAmt}`;
              sideClass = "side-b";
          } else if (nextP > 0 && nextP === nextB) {
              formula = `P(${nextP}) = B(${nextB}) (OFFSET)`;
          }
  
          const reductionCap = unit + 0.01; 
          let gap = reductionCap - state.realBalance;
          
          if (gap > 0 && netAmt > 0) {
              let maxAllowed = (netSide === 'P') ? gap : (gap / 0.95);
              if (netAmt > maxAllowed) {
                  let original = netAmt;
                  netAmt = maxAllowed;
                  if (chip > 0) netAmt = Math.ceil(netAmt / chip) * chip;
                  if (netAmt < unit) netAmt = unit;
                  if (netAmt < original) isReduced = true;
              }
          }
  
          document.getElementById('rec_amount').innerText = netAmt.toLocaleString();
          document.getElementById('rec_side').innerText = netSide;
          document.getElementById('rec_side').className = `rec-side ${sideClass}`;
          document.getElementById('formula_disp').innerText = formula;
          document.getElementById('reduced_tag').style.display = isReduced ? 'block' : 'none';
  
          document.getElementById('mon_p_req').innerText = nextP.toLocaleString();
          document.getElementById('mon_b_req').innerText = nextB.toLocaleString();
          document.getElementById('mon_p_info').innerText = `Wait: ${state.pStrat.wait} | Stg: ${state.pStrat.stage}`;
          document.getElementById('mon_b_info').innerText = `Wait: ${state.bStrat.wait} | Stg: ${state.bStrat.stage}`;
  
          // --- UPDATED LOGIC FOR STATUS ---
          const statusElem = document.getElementById('target_status_display');
          
          // Check if target was EVER hit (state.firstTargetHit) instead of current balance
          if (state.firstTargetHit) {
              statusElem.innerHTML = `
                  <span class='status-done'>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏ï‡∏Å (DONE)</span>
                  <div class='warn-flash'>‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏∞‡∏ö‡∏ö<br>Recommend System Reset</div>
              `;
          } else {
              statusElem.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...";
          }
          // --------------------------------
  
          const profitElem = document.getElementById('disp_net');
          profitElem.innerText = state.realBalance.toLocaleString(undefined, {minimumFractionDigits: 2});
          profitElem.style.color = state.realBalance >= 0 ? 'var(--tie)' : 'var(--banker)';
  
          document.getElementById('disp_dd').innerText = state.maxDrawdown.toLocaleString(undefined, {minimumFractionDigits: 2});
          document.getElementById('disp_maxbet').innerText = state.maxBet.toLocaleString();
          document.getElementById('disp_hands').innerText = state.history.length;
  
          document.getElementById('disp_dd_pre').innerText = state.preTargetDD.toLocaleString(undefined, {minimumFractionDigits: 2});
          document.getElementById('disp_bet_pre').innerText = state.preTargetMaxBet.toLocaleString();
  
          renderBigRoad();
          updateChart();
      }
  
      function renderBigRoad() {
          const roadDiv = document.getElementById('road_container');
          roadDiv.innerHTML = '';
          
          let matrix = []; 
          let col = 0;
          let row = 0;
          let lastWinner = null;
          
          const setCell = (c, r, val) => {
              if (!matrix[c]) matrix[c] = [];
              matrix[c][r] = val;
          };
  
          state.history.forEach(res => {
              if (lastWinner === null) {
                  setCell(col, row, res);
                  lastWinner = res;
              } else {
                  if (res === lastWinner) {
                      // Check if we can go down (Standard)
                      // Condition: Not at bottom AND cell below is empty
                      let cellBelowTaken = (matrix[col] && matrix[col][row+1] !== undefined);
                      
                      if (row < 5 && !cellBelowTaken) {
                          row++;
                      } else {
                          // DRAGON TAIL LOGIC: Go Right
                          col++;
                          // Row stays the same (usually 5, or wherever the collision happened)
                      }
                      setCell(col, row, res);
                  } else {
                      // New Winner -> New Column, Reset Row
                      col++;
                      row = 0;
                      setCell(col, row, res);
                      lastWinner = res;
                  }
              }
          });
  
          const maxCol = matrix.length;
          const renderCols = Math.max(20, maxCol);
          
          for (let c = 0; c < renderCols; c++) {
              for (let r = 0; r < 6; r++) {
                  let cell = document.createElement('div');
                  cell.className = 'big-road-cell';
                  
                  if (matrix[c] && matrix[c][r]) {
                      let val = matrix[c][r];
                      let circle = document.createElement('div');
                      circle.className = `circle circle-${val}`;
                      circle.innerText = val; 
                      cell.appendChild(circle);
                  }
                  
                  roadDiv.appendChild(cell);
              }
          }
      }
  
      function updateChart() {
          const ctx = document.getElementById('profitChart').getContext('2d');
          
          const pointRadii = state.graphData.map(val => val > 0 ? 5 : 0);
          const pointColors = state.graphData.map(val => val > 0 ? '#2ecc71' : '#2980b9');
  
          if (!chartInstance) {
              chartInstance = new Chart(ctx, {
                  type: 'line',
                  data: {
                      labels: state.graphLabels,
                      datasets: [{
                          label: 'Net Profit',
                          data: state.graphData,
                          borderColor: '#2980b9',
                          backgroundColor: 'rgba(41, 128, 185, 0.1)',
                          borderWidth: 2,
                          fill: true,
                          pointRadius: pointRadii,
                          pointBackgroundColor: pointColors,
                          tension: 0.1
                      }]
                  },
                  options: {
                      responsive: true,
                      maintainAspectRatio: false,
                      animation: { duration: 0 },
                      plugins: { legend: { display: false } },
                      scales: { x: { display: false }, y: { grid: { color: '#f0f0f0' } } }
                  }
              });
          } else {
              chartInstance.data.labels = state.graphLabels;
              chartInstance.data.datasets[0].data = state.graphData;
              chartInstance.data.datasets[0].borderColor = state.realBalance >= 0 ? '#27ae60' : '#c0392b';
              chartInstance.data.datasets[0].backgroundColor = state.realBalance >= 0 ? 'rgba(39, 174, 96, 0.1)' : 'rgba(192, 57, 43, 0.1)';
              chartInstance.data.datasets[0].pointRadius = pointRadii;
              chartInstance.data.datasets[0].pointBackgroundColor = pointColors;
              chartInstance.update();
          }
      }
  
      function saveState() {
          undoStack.push(JSON.parse(JSON.stringify(state)));
          if (undoStack.length > 20) undoStack.shift();
      }
      function undo() {
          if (undoStack.length === 0) return;
          state = undoStack.pop();
          updateUI();
      }
      function resetAll() {
          if(confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) location.reload();
      }
      function showWinModal() { document.getElementById('winModal').style.display = 'flex'; }
      function closeWinModal() { document.getElementById('winModal').style.display = 'none'; }
      
      function runSimulation() {
          const n = parseInt(document.getElementById('sim_hands').value);
          saveState();
          const unit = parseFloat(document.getElementById('min_bet').value);
          const winTarget = unit + 0.01;
  
          for(let i=0; i<n; i++) {
              processResult(Math.random() < 0.4932 ? 'P' : 'B', true);
          }
          updateUI();
          if (state.realBalance >= winTarget) {
              showWinModal();
              state.targetReached = true;
          }
      }
  
      function importLogs() {
          let input = prompt("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÄ‡∏ä‡πà‡∏ô PPBBPB...):");
          if (input) {
              let clean = input.toUpperCase().replace(/[^PBT]/g, '');
              if (clean.length > 0) {
                  saveState();
                  const unit = parseFloat(document.getElementById('min_bet').value);
                  const winTarget = unit + 0.01;
  
                  let chars = clean.split('');
                  chars.forEach(c => {
                      processResult(c, true); 
                  });
                  updateUI();
                  if (state.realBalance >= winTarget) {
                      showWinModal();
                      state.targetReached = true;
                  }
                  alert(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ${chars.length} ‡∏ï‡∏≤`);
              } else {
                  alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (P, B, T)");
              }
          }
      }
  
      window.onload = updateUI;
  </script>
  </body>
  </html>
````
