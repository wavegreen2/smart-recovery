<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baccarat Logic Pro - Exact Match</title>
    <style>
        :root { 
            --player: #007bff; 
            --banker: #dc3545; 
            --tie: #28a745; 
            --bg: #f0f2f5; 
            --card: #ffffff; 
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: var(--bg); 
            padding: 20px; 
            color: #333; 
            line-height: 1.6;
        }
        
        .wrapper { 
            max-width: 1200px; 
            margin: 0 auto; 
            display: grid; 
            grid-template-columns: 320px 1fr; 
            gap: 20px; 
        }
        
        .sidebar { 
            background: var(--card); 
            padding: 20px; 
            border-radius: 12px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            height: fit-content;
        }
        
        .sidebar h3 {
            margin-bottom: 20px;
            color: #333;
            font-size: 1.3rem;
        }
        
        .input-field { 
            margin-bottom: 15px; 
        }
        
        .input-field label { 
            display: block; 
            font-size: 13px; 
            font-weight: 600; 
            color: #555; 
            margin-bottom: 5px; 
        }
        
        .input-field input { 
            width: 100%; 
            padding: 10px; 
            border: 1px solid #ddd; 
            border-radius: 6px; 
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .input-field input:focus {
            outline: none;
            border-color: var(--player);
        }
        
        .main {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .stats-container { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 15px; 
        }
        
        .stat-item { 
            background: var(--card); 
            padding: 20px; 
            border-radius: 10px; 
            text-align: center; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-bottom: 4px solid #ddd;
            transition: transform 0.2s;
        }
        
        .stat-item:hover {
            transform: translateY(-2px);
        }
        
        .stat-item.profit { 
            border-bottom-color: var(--player); 
        }
        
        .stat-item.danger {
            border-bottom-color: var(--banker);
        }
        
        .stat-label { 
            font-size: 11px; 
            color: #888; 
            text-transform: uppercase; 
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        
        .stat-value { 
            font-size: 1.5rem; 
            font-weight: bold; 
            color: #333;
        }
        
        .road-map-box { 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            overflow-x: auto; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            min-height: 200px;
        }
        
        .road-grid { 
            display: grid; 
            grid-template-rows: repeat(6, 32px); 
            grid-auto-columns: 32px; 
            grid-auto-flow: column; 
            gap: 3px; 
        }
        
        .cell { 
            width: 30px; 
            height: 30px; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 11px; 
            font-weight: bold; 
            color: white;
            transition: transform 0.2s;
        }
        
        .cell:hover {
            transform: scale(1.1);
        }
        
        .cell.P { 
            background: var(--player); 
        }
        
        .cell.B { 
            background: var(--banker); 
        }
        
        .cell.T { 
            color: var(--tie); 
            border: 2px solid var(--tie); 
            background: white; 
            border-radius: 4px; 
        }

        .bet-area { 
            background: var(--card); 
            padding: 30px; 
            border-radius: 15px; 
            text-align: center; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .bet-area.active-p { 
            background: linear-gradient(135deg, var(--player) 0%, #0056b3 100%);
            color: white; 
        }
        
        .bet-area.active-p .bet-title, 
        .bet-area.active-p .bet-amount { 
            color: white; 
        }
        
        .bet-area.active-p .badge {
            background: rgba(255,255,255,0.2);
            color: white;
            border-color: white;
        }

        .status-info { 
            display: flex; 
            justify-content: center; 
            gap: 10px; 
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .badge { 
            padding: 6px 14px; 
            border-radius: 20px; 
            font-size: 0.75rem; 
            font-weight: bold;
            border: 1px solid transparent;
        }
        
        .badge-v { 
            background: #e9ecef; 
            color: #495057; 
        }
        
        .badge-r { 
            background: #fff3cd; 
            color: #856404; 
            border-color: #ffeeba; 
        }
        
        .badge-danger { 
            background: #f8d7da; 
            color: #721c24;
            border-color: #f5c6cb;
        }
        
        .bet-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #666;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .bet-amount {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--player);
            margin-bottom: 20px;
        }

        .btn-row { 
            display: flex; 
            gap: 10px; 
            justify-content: center;
            flex-wrap: wrap;
        }
        
        button { 
            padding: 14px 28px; 
            border: none; 
            border-radius: 8px; 
            font-weight: bold; 
            cursor: pointer; 
            transition: all 0.2s; 
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .btn-p { 
            background: var(--player); 
            color: white; 
            flex: 1;
            min-width: 120px;
        }
        
        .btn-p:hover {
            background: #0056b3;
        }
        
        .btn-b { 
            background: var(--banker); 
            color: white; 
            flex: 1;
            min-width: 120px;
        }
        
        .btn-b:hover {
            background: #c82333;
        }
        
        .btn-t { 
            background: var(--tie); 
            color: white;
            min-width: 100px;
        }
        
        .btn-t:hover {
            background: #218838;
        }
        
        .btn-undo { 
            background: #6c757d; 
            color: white;
            min-width: 100px;
        }
        
        .btn-undo:hover {
            background: #5a6268;
        }
        
        .btn-reset { 
            background: #343a40; 
            color: white; 
            width: 100%; 
            margin-top: 20px;
        }
        
        .btn-reset:hover {
            background: #23272b;
        }
        
        @media (max-width: 768px) {
            .wrapper {
                grid-template-columns: 1fr;
            }
            
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .btn-row {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>

<div class="wrapper">
    <!-- Sidebar -->
    <div class="sidebar">
        <h3>‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h3>
        <div class="input-field">
            <label>‡∏ó‡∏∏‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (Initial Bankroll)</label>
            <input type="number" id="init_bank" value="500000">
        </div>
        <div class="input-field">
            <label>‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ (Unit Size)</label>
            <input type="number" id="unit_size" value="5">
        </div>
        <div class="input-field">
            <label>‡∏ä‡∏¥‡∏õ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ (Chip Size)</label>
            <input type="number" id="chip_size" value="5">
        </div>
        <div class="input-field">
            <label>‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (Max Bet)</label>
            <input type="number" id="stop_loss_limit" value="75000">
        </div>
        <div class="input-field">
            <label>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≠‡∏î‡πÄ‡∏™‡∏µ‡∏¢ (Rebate %)</label>
            <input type="number" id="rebate_rate" step="0.001" value="0.01">
        </div>
        <button class="btn-reset" onclick="resetSystem()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>

    <!-- Main Content -->
    <div class="main">
        <!-- Stats -->
        <div class="stats-container">
            <div class="stat-item profit">
                <div class="stat-label">‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</div>
                <div class="stat-value" id="stat_profit">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</div>
                <div class="stat-value" id="stat_max_bet">0</div>
            </div>
            <div class="stat-item danger">
                <div class="stat-label">Drawdown ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</div>
                <div class="stat-value" id="stat_max_dd">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">‡∏ó‡∏∏‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</div>
                <div class="stat-value" id="stat_bank">500000</div>
            </div>
        </div>

        <!-- Road Map -->
        <div class="road-map-box">
            <div class="road-grid" id="road_grid"></div>
        </div>

        <!-- Betting Panel -->
        <div class="bet-area" id="bet_panel">
            <div class="status-info">
                <div id="mode_tag" class="badge badge-v">‡∏£‡∏≠‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì VIRTUAL</div>
                <div id="loss_tag" class="badge badge-danger" style="display:none;">‡πÅ‡∏û‡πâ‡∏ï‡∏¥‡∏î: 0/4</div>
                <div id="state_tag" class="badge badge-v" style="display:none;">STATE: FLAT</div>
            </div>
            <div class="bet-title">‡∏¢‡∏≠‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</div>
            <div id="next_bet_display" class="bet-amount">‡∏£‡∏≠‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì</div>
            <div class="btn-row">
                <button class="btn-p" onclick="addHand('P')">üîµ PLAYER</button>
                <button class="btn-t" onclick="addHand('T')">üü¢ TIE</button>
                <button class="btn-b" onclick="addHand('B')">üî¥ BANKER</button>
            </div>
            <div class="btn-row" style="margin-top: 10px;">
                <button class="btn-undo" onclick="undoLast()">‚Ü©Ô∏è ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
            </div>
        </div>
    </div>
</div>

<script>
    // ========== CONFIGURATION ==========
    const SIDE_PREF = "PLAYER";  // ‡∏´‡∏£‡∏∑‡∏≠ "BANKER"
    const V_WIN_TRIGGER = 5;     // ‡∏ä‡∏ô‡∏∞ Virtual ‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á 5 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
    const LOSS_LIMIT = 4;        // ‡πÅ‡∏û‡πâ‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô 4 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏¢‡∏∏‡∏î

    // ========== GLOBAL STATE ==========
    let history = [];            // ‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ú‡∏• P, B, T
    let globalNet = 0;           // ‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥
    let totalRebate = 0;         // ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° rebate
    let maxBetUsed = 0;          // ‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ
    let maxDD = 0;               // Drawdown ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
    let peakNet = 0;             // ‡∏à‡∏∏‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Å‡∏≥‡πÑ‡∏£

    // ========== SESSION STATE ==========
    let isReal = false;          // ‡πÇ‡∏´‡∏°‡∏î Virtual ‡∏´‡∏£‡∏∑‡∏≠ Real
    let vWins = 0;               // ‡∏ô‡∏±‡∏ö‡∏ä‡∏ô‡∏∞ Virtual
    let consecutiveLoss = 0;     // ‡∏ô‡∏±‡∏ö‡πÅ‡∏û‡πâ‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô
    let sessionLoss = 0;         // ‡∏¢‡∏≠‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡πÉ‡∏ô‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡∏ô
    let activeUnit = 5;          // Unit ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á
    let state = "FLAT";          // FLAT ‡∏´‡∏£‡∏∑‡∏≠ MARTY
    let martStep = 0;            // ‡∏Ç‡∏±‡πâ‡∏ô‡∏Ç‡∏≠‡∏á Martingale
    let hasLostSincePeak = false; // ‡πÄ‡∏Ñ‡∏¢‡πÅ‡∏û‡πâ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ñ‡∏∂‡∏á‡∏à‡∏∏‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

    // ========== FUNCTIONS ==========

    /**
     * ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Active Unit ‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
     */
    function computeActiveUnit() {
        const unit = parseFloat(document.getElementById('unit_size').value);
        const chip = parseFloat(document.getElementById('chip_size').value);
        
        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì target
        const target = (globalNet >= 0) ? unit : (Math.abs(globalNet) + unit);
        
        // Aggressive recovery ratio = 5
        let au = unit;
        if (globalNet < 0) {
            au = Math.max(unit, target / 5);
        }
        
        // ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ chip size
        au = Math.max(au, chip);
        
        return au;
    }

    /**
     * ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏ï‡∏≤‡∏°‡∏ï‡∏£‡∏£‡∏Å‡∏∞ Python
     */
    function calculateBet() {
        if (!isReal) return 0;

        const unit = parseFloat(document.getElementById('unit_size').value);
        const chip = parseFloat(document.getElementById('chip_size').value);
        const limit = parseFloat(document.getElementById('stop_loss_limit').value);

        const safeUnit = Math.max(activeUnit, 0.1);
        const currentDrawdown = Math.max(0, peakNet - globalNet);

        // 1) ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì raw bet ‡∏ï‡∏≤‡∏° state
        let rawBet = safeUnit;
        
        if (state === "FLAT") {
            if (currentDrawdown > 0 && hasLostSincePeak) {
                // ‡πÉ‡∏ä‡πâ drawdown/4 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô
                rawBet = Math.ceil(currentDrawdown / 4);
                rawBet = Math.max(rawBet, safeUnit);
            } else {
                rawBet = safeUnit;
            }
        } else if (state === "MARTY") {
            // Martingale: ‡∏Ñ‡∏π‡∏ì 2 ‡∏ï‡∏≤‡∏° step
            rawBet = safeUnit * Math.pow(2, martStep);
        }

        // 2) ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏î‡πâ‡∏ß‡∏¢ needed to recover
        const neededToRecover = currentDrawdown + safeUnit;
        let bet = (state !== "FLAT") ? Math.min(rawBet, neededToRecover) : rawBet;

        // 3) ‡∏õ‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏¥‡∏õ
        bet = Math.ceil(bet / chip) * chip;

        // 4) ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏î‡πâ‡∏ß‡∏¢ remaining target
        const targetProfit = (globalNet >= 0) ? unit : (Math.abs(globalNet) + unit);
        const currentProfit = globalNet;
        const remaining = targetProfit - currentProfit;

        if (bet > remaining && remaining > 0) {
            bet = Math.max(safeUnit, Math.ceil(remaining / chip) * chip);
        }

        // 5) ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏î‡πâ‡∏ß‡∏¢ limit
        if (bet >= limit) bet = limit;

        return bet;
    }

    /**
     * ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô
     */
    function addHand(res) {
        // ‡∏Å‡∏£‡∏ì‡∏µ TIE ‡πÑ‡∏°‡πà‡∏ô‡∏±‡∏ö‡∏ú‡∏•
        if (res === 'T') {
            history.push('T');
            renderRoad();
            return;
        }

        const side = (SIDE_PREF === "PLAYER") ? "P" : "B";
        const isWin = (res === side);

        // ========== VIRTUAL MODE ==========
        if (!isReal) {
            if (isWin) {
                vWins++;
            } else {
                vWins = 0;
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ñ‡∏∂‡∏á‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÄ‡∏Ç‡πâ‡∏≤ Real Mode ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (vWins >= V_WIN_TRIGGER) {
                isReal = true;
                consecutiveLoss = 0;
                sessionLoss = 0;

                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì active unit ‡πÉ‡∏´‡∏°‡πà
                activeUnit = computeActiveUnit();
                state = "FLAT";
                martStep = 0;
                hasLostSincePeak = (peakNet > globalNet);
            }
        } 
        // ========== REAL MODE ==========
        else {
            const bet = calculateBet();
            if (bet > maxBetUsed) maxBetUsed = bet;

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì payout (Banker ‡∏à‡πà‡∏≤‡∏¢ 0.95)
            const payout = (res === 'B' && SIDE_PREF === "BANKER") ? 0.95 : 1.0;
            const winLoss = isWin ? (bet * payout) : -bet;

            // ‡πÄ‡∏û‡∏¥‡πà‡∏° rebate
            const rebateRate = parseFloat(document.getElementById('rebate_rate').value);
            totalRebate += (bet * rebateRate);

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï global net
            globalNet += winLoss;

            // ========== ‡∏Å‡∏£‡∏ì‡∏µ‡∏ä‡∏ô‡∏∞ ==========
            if (isWin) {
                consecutiveLoss = 0;
                sessionLoss = 0;

                // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï flag ‡∏ñ‡πâ‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏ñ‡∏∂‡∏á‡∏à‡∏∏‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
                if (globalNet >= peakNet) {
                    hasLostSincePeak = false;
                }

                // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï state
                state = "FLAT";
                martStep = 0;

                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≥‡πÑ‡∏£‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                const targetProfit = parseFloat(document.getElementById('unit_size').value);
                if (globalNet >= targetProfit) {
                    isReal = false;
                    vWins = 0;
                    alert(`üéâ SESSION WIN! ‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${globalNet.toFixed(1)}`);
                }
            } 
            // ========== ‡∏Å‡∏£‡∏ì‡∏µ‡πÅ‡∏û‡πâ ==========
            else {
                consecutiveLoss++;
                sessionLoss += bet;
                hasLostSincePeak = true;

                // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô state
                if (state === "FLAT") {
                    state = "MARTY";
                    martStep = 1;
                } else if (state === "MARTY") {
                    martStep += 1;
                }

                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö stop loss
                if (consecutiveLoss >= LOSS_LIMIT) {
                    isReal = false;
                    vWins = 0;
                    alert(`‚õî STOP LOSS! ‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${globalNet.toFixed(1)}`);
                }
            }
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï peak ‡πÅ‡∏•‡∏∞ drawdown
        if (globalNet > peakNet) {
            peakNet = globalNet;
        }
        
        const currentDD = peakNet - globalNet;
        if (currentDD > maxDD) {
            maxDD = currentDD;
        }

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
        history.push(res);
        renderRoad();
        updateUI();
    }

    /**
     * ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
     */
    function updateUI() {
        const initBank = parseFloat(document.getElementById('init_bank').value);
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
        document.getElementById('stat_profit').innerText = (globalNet + totalRebate).toLocaleString('th-TH', {minimumFractionDigits: 1});
        document.getElementById('stat_max_bet').innerText = maxBetUsed.toLocaleString('th-TH');
        document.getElementById('stat_max_dd').innerText = maxDD.toLocaleString('th-TH', {minimumFractionDigits: 1});
        document.getElementById('stat_bank').innerText = (initBank + globalNet + totalRebate).toLocaleString('th-TH', {minimumFractionDigits: 1});

        const modeTag = document.getElementById('mode_tag');
        const lossTag = document.getElementById('loss_tag');
        const stateTag = document.getElementById('state_tag');
        const betDisplay = document.getElementById('next_bet_display');
        const betPanel = document.getElementById('bet_panel');

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ï‡∏≤‡∏° mode
        if (!isReal) {
            modeTag.innerText = `‡∏£‡∏≠‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì VIRTUAL: ${vWins}/${V_WIN_TRIGGER}`;
            modeTag.className = "badge badge-v";
            lossTag.style.display = "none";
            stateTag.style.display = "none";
            betDisplay.innerText = "‡∏£‡∏≠‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì";
            betPanel.classList.remove('active-p');
        } else {
            modeTag.innerText = "üî¥ REAL MODE";
            modeTag.className = "badge badge-r";
            
            lossTag.style.display = "block";
            lossTag.innerText = `‡πÅ‡∏û‡πâ‡∏ï‡∏¥‡∏î: ${consecutiveLoss}/${LOSS_LIMIT}`;
            
            stateTag.style.display = "block";
            stateTag.innerText = `STATE: ${state}${state === "MARTY" ? " (Step " + martStep + ")" : ""}`;
            
            const nextBet = calculateBet();
            betDisplay.innerText = nextBet.toLocaleString('th-TH');
            
            if (SIDE_PREF === "PLAYER") {
                betPanel.classList.add('active-p');
            }
        }
    }

    /**
     * ‡πÅ‡∏™‡∏î‡∏á Road Map
     */
    function renderRoad() {
        const grid = document.getElementById('road_grid');
        grid.innerHTML = '';

        // ‡πÅ‡∏õ‡∏•‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå (‡πÑ‡∏°‡πà‡∏ô‡∏±‡∏ö T)
        let columns = [[]];
        let colIndex = 0;
        let lastResult = '';

        history.filter(x => x !== 'T').forEach(result => {
            if (lastResult && result !== lastResult) {
                colIndex++;
                columns[colIndex] = [];
            }
            columns[colIndex].push(result);
            lastResult = result;
        });

        // ‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏¥‡∏î
        columns.forEach(col => {
            for (let row = 0; row < 6; row++) {
                const cell = document.createElement('div');
                const result = col[row] || '';
                cell.className = 'cell ' + result;
                cell.innerText = result;
                grid.appendChild(cell);
            }
        });
    }

    /**
     * ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏ú‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
     */
    function undoLast() {
        if (history.length > 0) {
            history.pop();
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÜ (‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏à‡∏£‡∏¥‡∏á‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡πá‡∏ö state stack)
            // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡πà‡∏≤‡∏¢ ‡πÉ‡∏´‡πâ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏õ‡πá‡∏ô virtual
            isReal = false;
            vWins = 0;
            consecutiveLoss = 0;
            sessionLoss = 0;
            state = "FLAT";
            martStep = 0;
            
            renderRoad();
            updateUI();
        }
    }

    /**
     * ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
     */
    function resetSystem() {
        if (confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
            location.reload();
        }
    }

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
    window.onload = function() {
        updateUI();
    };
</script>

</body>
</html>
