<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baccarat Live Assistant</title>
    <style>
        body { font-family: 'Kanit', sans-serif; background: #1a1a1a; color: white; padding: 20px; display: flex; justify-content: center; }
        .container { max-width: 600px; width: 100%; background: #2d2d2d; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h2 { text-align: center; color: #00d2ff; margin-bottom: 25px; }
        
        .setup-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; border-bottom: 1px solid #444; padding-bottom: 20px; }
        .input-item { display: flex; flex-direction: column; }
        label { font-size: 0.85em; color: #aaa; margin-bottom: 5px; }
        input, select { background: #3d3d3d; border: 1px solid #555; color: white; padding: 10px; border-radius: 8px; }

        .bet-display { background: #000; padding: 20px; border-radius: 12px; text-align: center; margin-bottom: 20px; border: 2px solid #00d2ff; }
        .bet-label { font-size: 1.1em; color: #00d2ff; }
        .bet-amount { font-size: 3em; font-weight: bold; margin: 10px 0; color: #fff; }
        .status-badge { display: inline-block; padding: 5px 15px; border-radius: 20px; font-size: 0.9em; background: #444; }

        .action-buttons { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .btn-p { background: #007bff; }
        .btn-b { background: #dc3545; }
        .btn-t { background: #28a745; }
        .btn-action { border: none; padding: 20px; color: white; border-radius: 10px; cursor: pointer; font-size: 1.2em; font-weight: bold; transition: 0.2s; }
        .btn-action:hover { opacity: 0.8; transform: scale(0.98); }

        #log-area { background: #111; padding: 15px; border-radius: 8px; height: 200px; overflow-y: auto; font-family: monospace; font-size: 13px; color: #0f0; }
        .stats { margin-top: 15px; font-size: 0.9em; color: #ccc; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h2>üéØ Baccarat Live Pro</h2>
    
    <div class="setup-grid">
        <div class="input-item">
            <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÄ‡∏á‡∏¥‡∏ô (Unit)</label>
            <input type="number" id="unit_size" value="10">
        </div>
        <div class="input-item">
            <label>‡πÅ‡∏ó‡∏á‡∏ù‡∏±‡πà‡∏á (Preference)</label>
            <select id="side_preference">
                <option value="PLAYER">PLAYER</option>
                <option value="BANKER">BANKER</option>
            </select>
        </div>
    </div>

    <div class="bet-display">
        <div class="bet-label">‡∏ï‡∏≤‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‡πÅ‡∏ó‡∏á <span id="target_side">...</span></div>
        <div class="bet-amount" id="display_bet">10.00</div>
        <div class="status-badge" id="current_state">STATE: FLAT</div>
    </div>

    <div class="action-buttons">
        <button class="btn-action btn-p" onclick="processResult('P')">PLAYER</button>
        <button class="btn-action btn-b" onclick="processResult('B')">BANKER</button>
        <button class="btn-action btn-t" onclick="processResult('T')">TIE</button>
    </div>

    <div class="stats">
        <div>‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∞‡∏™‡∏°: <span id="stat_profit" style="color: #0f0;">0.00</span></div>
        <div>Max Bet: <span id="stat_max_bet" style="color: #ff0;">0.00</span></div>
        <div>Drawdown: <span id="stat_mdd" style="color: #f00;">0.00</span></div>
        <div>‡∏ï‡∏≤‡∏ó‡∏µ‡πà: <span id="stat_hand">0</span></div>
    </div>

    <div id="log-area">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö... ‡∏£‡∏≠‡πÉ‡∏™‡πà‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏°‡∏∑‡∏≠‡πÅ‡∏£‡∏Å</div>
    
    <button onclick="resetSim()" style="width: 100%; margin-top: 15px; background: none; border: 1px solid #666; color: #666; padding: 5px; cursor: pointer;">Reset Data</button>
</div>

<script>
    // --- ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞ State ---
    let config = {
        unit_size: 10,
        side_preference: 'PLAYER',
        marty_mult: 2,
        fibo_mult: 10,
        rebate_rate: 0.01
    };

    let session = {
        bankroll: 0,
        initial_bankroll: 0,
        peak_bankroll: 0,
        max_bet: 0,
        max_drawdown: 0,
        state: "FLAT",
        marty_step: 0,
        fibo_idx: 0,
        hand_count: 0,
        has_lost_since_peak: false,
        marty_limit: 12
    };

    const getFibo = (n) => {
        if (n <= 0) return 1;
        if (n === 1) return 1;
        let a = 1, b = 1;
        for (let i = 2; i <= n; i++) [a, b] = [b, a + b];
        return b;
    };

    // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å ---
    function calculateNextBet() {
        config.unit_size = parseFloat(document.getElementById('unit_size').value);
        config.side_preference = document.getElementById('side_preference').value;

        let currentDrawdown = session.peak_bankroll - session.bankroll;
        let rawBet = config.unit_size;

        if (session.state === "FLAT") {
            if (currentDrawdown > 0 && session.has_lost_since_peak) {
                rawBet = Math.max(Math.ceil(currentDrawdown / 4), config.unit_size);
            }
        } else if (session.state === "MARTY") {
            rawBet = config.unit_size * Math.pow(config.marty_mult, session.marty_step);
        } else if (session.state === "FIBO") {
            rawBet = getFibo(session.fibo_idx) * config.fibo_mult;
        }

        // ‡∏Å‡∏±‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß (Recovery logic)
        let neededToRecover = currentDrawdown + config.unit_size;
        let bet = (session.state !== "FLAT") ? Math.min(rawBet, neededToRecover) : rawBet;

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
        document.getElementById('display_bet').innerText = bet
