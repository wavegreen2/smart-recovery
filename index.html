<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baccarat Pro Dashboard v4</title>
    <style>
        :root { --p-color: #007bff; --b-color: #dc3545; --t-color: #28a745; --bg-dark: #121212; --card-bg: #1e1e1e; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg-dark); color: #fff; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        .header-stats { display: flex; gap: 10px; padding: 10px; background: #000; border-bottom: 1px solid #333; }
        .stat-item { flex: 1; background: var(--card-bg); padding: 8px; border-radius: 5px; text-align: center; border: 1px solid #444; }
        .stat-label { font-size: 0.7rem; color: #888; display: block; }
        .stat-value { font-size: 1.1rem; font-weight: bold; }

        .main-content { display: grid; grid-template-columns: 280px 1fr; flex: 1; overflow: hidden; }
        
        /* Sidebar */
        .sidebar { background: #181818; padding: 15px; border-right: 1px solid #333; overflow-y: auto; }
        .control-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.8rem; color: #bbb; margin-bottom: 3px; }
        input, select, textarea { width: 100%; padding: 8px; background: #2a2a2a; border: 1px solid #444; color: #fff; border-radius: 4px; box-sizing: border-box; margin-bottom: 8px; }
        
        .btn { width: 100%; padding: 10px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; transition: 0.2s; margin-bottom: 5px; }
        .btn-start { background: #28a745; color: white; }
        .btn-undo { background: #555; color: white; font-size: 0.9rem; margin-top: 10px; border: 1px solid #777; width: 48%; }
        .btn-reset { background: #852626; color: white; font-size: 0.9rem; margin-top: 10px; border: 1px solid #b33939; width: 48%; }
        .btn-manual { flex: 1; height: 50px; color: white; border-radius: 4px; font-size: 1.2rem; }

        /* Advice Banner */
        .advice-banner { padding: 15px; border-radius: 5px; margin-bottom: 10px; text-align: center; font-weight: 800; font-size: 1.4rem; border: 2px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center; }
        .advice-P { background: var(--p-color); box-shadow: 0 0 15px rgba(0,123,255,0.4); }
        .advice-WAIT { background: #333; color: #aaa; }

        /* Big Road */
        .road-section { background: #000; border-bottom: 1px solid #333; padding: 10px; overflow-x: auto; }
        .road-container { display: grid; grid-template-columns: repeat(120, 22px); grid-template-rows: repeat(6, 22px); gap: 1px; background: #333; width: fit-content; }
        .road-cell { background: #fff; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; }
        .cell-P { color: var(--p-color); } .cell-B { color: var(--b-color); } 
        .cell-T { color: var(--t-color); border: 1px solid var(--t-color); border-radius: 50%; width: 16px; height: 16px; }

        .table-area { flex: 1; overflow-y: auto; padding: 10px; }
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        th { background: #252525; position: sticky; top: 0; padding: 8px; text-align: left; color: #888; border-bottom: 2px solid #333; z-index: 10; }
        td { padding: 8px; border-bottom: 1px solid #2a2a2a; }
        .win-row { background: rgba(46, 204, 113, 0.05); color: #2ecc71; }
        .loss-row { background: rgba(231, 76, 60, 0.05); color: #e74c3c; }
    </style>
</head>
<body>

<div class="header-stats">
    <div class="stat-item"><span class="stat-label">REAL NET PROFIT</span><span id="stat_profit" class="stat-value">0.00</span></div>
    <div class="stat-item"><span class="stat-label">COMMISSION</span><span id="stat_comm" class="stat-value">0.00</span></div>
    <div class="stat-item"><span class="stat-label">MAX BET</span><span id="stat_max_bet" class="stat-value">0</span></div>
    <div class="stat-item"><span class="stat-label">SESSION</span><span id="stat_session" class="stat-value">1</span></div>
</div>

<div class="main-content">
    <div class="sidebar">
        <div class="control-group">
            <label>‡πÇ‡∏´‡∏°‡∏î (Mode)</label>
            <select id="mode" onchange="toggleMode()">
                <option value="m">Manual Input (‡∏Å‡∏î‡∏°‡∏∑‡∏≠)</option>
                <option value="r">Random (‡∏™‡∏∏‡πà‡∏°)</option>
                <option value="s">Data String (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö)</option>
            </select>
        </div>
        
        <div id="string_box" class="control-group" style="display:none;">
            <label>Data String</label>
            <textarea id="data_string" placeholder="P,B,T,P..."></textarea>
        </div>

        <div class="control-group">
            <label>‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ (Min Bet)</label>
            <input type="number" id="unit_size" value="5.0">
            <label>‡∏ä‡∏¥‡∏õ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ (Min Chip)</label>
            <input type="number" id="chip_size" value="5.0">
            <label>Stop Loss Threshold</label>
            <input type="number" id="stop_loss" value="75000">
            <label>‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏Ø (Commission %)</label>
            <input type="number" id="comm_rate" value="1.0" step="0.1">
        </div>

        <button class="btn btn-start" onclick="startSystem()">START SYSTEM</button>

        <div id="manual_ctrl" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #333;">
            <label>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏°‡∏∑‡∏≠‡∏ï‡πà‡∏≠‡∏°‡∏∑‡∏≠</label>
            <div style="display:flex; gap:5px;">
                <button class="btn btn-manual" style="background:var(--p-color)" onclick="inputResult('P')">P</button>
                <button class="btn btn-manual" style="background:var(--b-color)" onclick="inputResult('B')">B</button>
                <button class="btn btn-manual" style="background:var(--t-color)" onclick="inputResult('T')">T</button>
            </div>
            <div style="display:flex; justify-content: space-between;">
                <button class="btn btn-undo" onclick="undoLastHand()">‚Ü© Undo</button>
                <button class="btn btn-reset" onclick="resetAll()">üîÑ Reset</button>
            </div>
        </div>
    </div>

    <div style="display: flex; flex-direction: column; overflow: hidden; padding: 10px;">
        <div id="advice_banner" class="advice-banner advice-WAIT">
            <span id="advice_side">READY</span>
            <span id="advice_bet">0.00</span>
        </div>

        <div class="road-section" id="road_wrapper">
            <div class="road-container" id="big_road"></div>
        </div>

        <div class="table-area">
            <table>
                <thead>
                    <tr>
                        <th>Hand #</th>
                        <th>Type</th>
                        <th>Result</th>
                        <th>Bet Amount</th>
                        <th>Outcome</th>
                        <th>Balance</th>
                        <th>Net Profit</th>
                    </tr>
                </thead>
                <tbody id="history_body"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    let app = {
        active: false,
        br: 500000.0,
        netProfit: 0,
        totalComm: 0,
        maxBet: 0,
        handCount: 0,
        sessionIdx: 1,
        fullHistory: [], 
        roadHistory: [], 
        state: "FLAT",
        martyStep: 0,
        peak: 500000.0,
        lossSincePeak: false,
        vLossCount: 0,
        accumulatedLoss: 0,
        targetProfit: 0.01
    };

    function startSystem() {
        app.active = true;
        if (document.getElementById('mode').value === 's') processDataString();
        else if (document.getElementById('mode').value === 'r') runRandomLoop();
        updateUI();
    }

    function resetAll() {
        if(!confirm("‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
        app = {
            active: false, br: 500000.0, netProfit: 0, totalComm: 0, maxBet: 0,
            handCount: 0, sessionIdx: 1, fullHistory: [], roadHistory: [],
            state: "FLAT", martyStep: 0, peak: 500000.0, lossSincePeak: false,
            vLossCount: 0, accumulatedLoss: 0, targetProfit: 0.01
        };
        document.getElementById('history_body').innerHTML = "";
        renderRoad();
        updateUI();
    }

    function resetSession() {
        app.br = 500000.0;
        app.peak = 500000.0;
        app.state = "FLAT";
        app.martyStep = 0;
        app.lossSincePeak = false;
    }

    function calculateBet() {
        const minBet = parseFloat(document.getElementById('unit_size').value);
        const minChip = parseFloat(document.getElementById('chip_size').value);
        const stopLoss = parseFloat(document.getElementById('stop_loss').value);
        let drawdown = app.peak - app.br;
        let bet = (app.state === "MARTY") ? minBet * Math.pow(2, app.martyStep) : 
                  (drawdown > 0 && app.lossSincePeak ? Math.max(Math.ceil(drawdown / 4), minBet) : minBet);
        let needed = drawdown + minBet;
        if (app.state !== "FLAT") bet = Math.min(bet, needed);
        if (bet > stopLoss) bet = stopLoss;
        return Math.ceil(bet / minChip) * minChip;
    }

    function inputResult(res) {
        if (!app.active) return;
        const bet = calculateBet();
        const sidePref = "PLAYER"; 
        const win = (res === 'P' && sidePref === 'PLAYER') || (res === 'B' && sidePref === 'BANKER');
        const commRate = parseFloat(document.getElementById('comm_rate').value) / 100;
        const comm = bet * commRate;
        const isVirtual = app.vLossCount < 5;

        const snapshot = JSON.parse(JSON.stringify(app));
        app.handCount++;
        app.totalComm += comm;
        app.br += comm;
        if(!isVirtual) app.netProfit += comm;

        let outcome = 0;
        if (res !== 'T') {
            if (win) {
                outcome = (sidePref === 'BANKER' ? bet * 0.95 : bet);
                app.br += outcome;
                if(!isVirtual) app.netProfit += outcome;
                app.state = "FLAT"; app.martyStep = 0;
                if (app.br >= app.peak) app.lossSincePeak = false;
            } else {
                outcome = -bet;
                app.br += outcome;
                if(!isVirtual) app.netProfit -= bet;
                app.lossSincePeak = true;
                if (app.state === "FLAT") { app.state = "MARTY"; app.martyStep = 1; }
                else app.martyStep++;
            }
            app.roadHistory.push(res);
        }

        if (app.br > app.peak) app.peak = app.br;
        if (bet > app.maxBet) app.maxBet = bet;

        app.fullHistory.push({ snapshot, res, bet, outcome, isVirtual });
        addTableRow(app.handCount, isVirtual ? "VIRTUAL" : "REAL", res, bet, outcome, app.br, app.netProfit);

        let sessionP = app.br - 500000.0;
        let stopLimit = parseFloat(document.getElementById('stop_loss').value);
        if (app.br <= (500000 - stopLimit) || sessionP >= app.targetProfit) {
            if (isVirtual) { if (sessionP < 0) app.vLossCount++; else app.vLossCount = 0; }
            else {
                app.sessionIdx++;
                if (sessionP >= app.targetProfit) { app.accumulatedLoss = 0; app.targetProfit = 0.01; app.vLossCount = 0; }
                else { app.accumulatedLoss += Math.abs(sessionP); app.targetProfit = app.accumulatedLoss + 0.01; }
            }
            resetSession();
        }
        renderRoad();
        updateUI();
    }

    function undoLastHand() {
        if (app.fullHistory.length === 0) return;
        const last = app.fullHistory.pop();
        Object.assign(app, last.snapshot);
        if (last.res !== 'T') app.roadHistory.pop();
        document.getElementById('history_body').deleteRow(0);
        renderRoad();
        updateUI();
    }

    function addTableRow(id, type, res, bet, outcome, balance, net) {
        const body = document.getElementById('history_body');
        const row = body.insertRow(0);
        row.className = outcome > 0 ? "win-row" : (outcome < 0 ? "loss-row" : "");
        row.innerHTML = `<td>${id}</td><td>${type}</td><td>${res}</td><td>${bet.toLocaleString()}</td><td>${outcome > 0 ? '+' : ''}${outcome.toLocaleString()}</td><td>${balance.toLocaleString(undefined, {minimumFractionDigits: 2})}</td><td>${net.toLocaleString(undefined, {minimumFractionDigits: 2})}</td>`;
    }

    function renderRoad() {
        const container = document.getElementById('big_road');
        container.innerHTML = '';
        let matrix = Array(6).fill().map(() => Array(120).fill(null));
        let col = 0, row = 0, lastRes = '';
        app.roadHistory.forEach(res => {
            if (res !== lastRes && lastRes !== '') { col++; row = 0; while(matrix[0][col] !== null) col++; }
            let tR = row, tC = col;
            if (tR >= 6 || matrix[tR][tC] !== null) { tR = row - 1; tC = col + 1; while(matrix[tR][tC] !== null) tC++; matrix[tR][tC] = res; col = tC; }
            else { matrix[tR][tC] = res; row++; }
            lastRes = res;
        });
        for (let r = 0; r < 6; r++) { for (let c = 0; c < 120; c++) {
            const cell = document.createElement('div'); cell.className = 'road-cell';
            if (matrix[r][c]) { cell.innerText = matrix[r][c]; cell.className += ' cell-' + matrix[r][c]; }
            container.appendChild(cell);
        }}
        if(app.roadHistory.length > 0) document.getElementById('road_wrapper').scrollLeft = (col - 10) * 22;
    }

    function updateUI() {
        document.getElementById('stat_profit').innerText = app.netProfit.toLocaleString(undefined, {minimumFractionDigits: 2});
        document.getElementById('stat_comm').innerText = app.totalComm.toLocaleString(undefined, {minimumFractionDigits: 2});
        document.getElementById('stat_max_bet').innerText = app.maxBet.toLocaleString();
        document.getElementById('stat_session').innerText = app.sessionIdx;
        const bet = calculateBet();
        const sideTxt = document.getElementById('advice_side');
        const betTxt = document.getElementById('advice_bet');
        const banner = document.getElementById('advice_banner');
        if (!app.active) { sideTxt.innerText = "READY"; betTxt.innerText = "0.00"; banner.className="advice-banner advice-WAIT"; return; }
        if (app.vLossCount < 5) { sideTxt.innerText = `VIRTUAL (${app.vLossCount}/5)`; betTxt.innerText = bet.toLocaleString(); banner.className="advice-banner advice-WAIT"; }
        else { sideTxt.innerText = "BET PLAYER"; betTxt.innerText = bet.toLocaleString(); banner.className="advice-banner advice-P"; }
    }

    function toggleMode() {
        const m = document.getElementById('mode').value;
        document.getElementById('manual_ctrl').style.display = (m === 'm' ? 'block' : 'none');
        document.getElementById('string_box').style.display = (m === 's' ? 'block' : 'none');
    }

    function processDataString() {
        const arr = document.getElementById('data_string').value.split(/[, \n]+/).map(s => s.trim().toUpperCase()).filter(s => ['P','B','T'].includes(s));
        arr.forEach(res => inputResult(res));
    }

    async function runRandomLoop() {
        while(app.active && document.getElementById('mode').value === 'r') {
            inputResult(Math.random() > 0.5 ? 'P' : 'B');
            await new Promise(r => setTimeout(r, 400));
        }
    }
</script>
</body>
</html>
