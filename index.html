<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baccarat Strategy Simulator</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f4f7f6; color: #333; margin: 20px; }
        .container { max-width: 900px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { border-bottom: 2px solid #27ae60; padding-bottom: 10px; color: #2c3e50; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .input-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 14px; }
        input, select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        .btn-panel { display: flex; gap: 10px; margin-top: 20px; }
        button { flex: 1; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-run { background: #27ae60; color: white; }
        .btn-manual { background: #2980b9; color: white; }
        .btn-reset { background: #e74c3c; color: white; }
        #manual-input-area { display: none; margin-top: 20px; padding: 15px; background: #ecf0f1; border-radius: 8px; text-align: center; }
        .manual-btns button { width: 80px; margin: 5px; font-size: 18px; }
        #log { margin-top: 20px; height: 300px; overflow-y: scroll; background: #2c3e50; color: #ecf0f1; padding: 15px; font-family: monospace; border-radius: 8px; font-size: 13px; line-height: 1.6; }
        .summary { margin-top: 20px; display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; background: #f9f9f9; padding: 15px; border-radius: 8px; border-left: 5px solid #27ae60; }
        .win { color: #2ecc71; font-weight: bold; }
        .loss { color: #e74c3c; font-weight: bold; }
        .tie { color: #f1c40f; }
    </style>
</head>
<body>

<div class="container">
    <h2>ðŸŽ° Baccarat Strategy Simulator</h2>
    
    <div class="grid">
        <div class="input-group">
            <label>Unit Size (à¸«à¸™à¹ˆà¸§à¸¢à¹€à¸£à¸´à¹ˆà¸¡)</label>
            <input type="number" id="unit_size" value="10">
        </div>
        <div class="input-group">
            <label>Side Preference</label>
            <select id="side_preference">
                <option value="PLAYER">PLAYER</option>
                <option value="BANKER">BANKER</option>
            </select>
        </div>
        <div class="input-group">
            <label>Marty Multiplier</label>
            <input type="number" id="marty_mult" value="2.0" step="0.1">
        </div>
        <div class="input-group">
            <label>Fibo Multiplier</label>
            <input type="number" id="fibo_mult" value="100000">
        </div>
        <div class="input-group">
            <label>Stop Loss (Max Bet)</label>
            <input type="number" id="stop_loss" value="1000000">
        </div>
        <div class="input-group">
            <label>Rebate Rate (%)</label>
            <input type="number" id="rebate_rate" value="1" step="0.1">
        </div>
    </div>

    <div class="input-group">
        <label>Raw Data (à¸ªà¸³à¸«à¸£à¸±à¸šà¹‚à¸«à¸¡à¸” Auto)</label>
        <input type="text" id="raw_data" value="1,P,P,B,B,P,B,P,P,B,B,B,P,P,B,B,B,P,T,P,B,B,B,P,B,P">
    </div>

    <div class="btn-panel">
        <button class="btn-run" onclick="runAuto()">[A] Run Auto Data</button>
        <button class="btn-manual" onclick="startManual()">[M] Start Manual Input</button>
        <button class="btn-reset" onclick="resetAll()">Reset</button>
    </div>

    <div id="manual-input-area">
        <h3>à¹ƒà¸ªà¹ˆà¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œà¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™ (Hand <span id="hand-count">1</span>)</h3>
        <p>Betting Side: <strong id="current-bet-side">-</strong> | Amount: <strong id="current-bet-amt">0</strong></p>
        <div class="manual-btns">
            <button onclick="inputResult('P')" style="background:#2980b9; color:white;">P</button>
            <button onclick="inputResult('B')" style="background:#c0392b; color:white;">B</button>
            <button onclick="inputResult('T')" style="background:#f1c40f; color:black;">T</button>
        </div>
        <button onclick="stopManual()" style="margin-top:10px; background:#95a5a6; color:white; width:auto; padding:5px 15px;">Stop Manual</button>
    </div>

    <div id="summary-report" class="summary">
        <div>Total Bankroll: <span id="stat-br">1000000.00</span></div>
        <div>Max Bet: <span id="stat-max-bet">0.00</span></div>
        <div>Max Drawdown: <span id="stat-mdd">0.00</span></div>
        <div>Status: <span id="stat-status">IDLE</span></div>
    </div>

    <div id="log"></div>
</div>

<script>
    // --- Core Variables ---
    let bankroll = 10000000.0, initialBankroll = 10000000.0, peakBankroll = 10000000.0;
    let targetProfit = 0.01, unitSize = 10.0;
    let state = "FLAT", martyStep = 0, fiboIdx = 0;
    let maxBetEncoutered = 0, maxDrawdown = 0;
    let hasLostSincePeak = false;
    let handCounter = 1;

    // --- Helper Functions ---
    function getFibo(n) {
        if (n <= 0) return 1;
        if (n === 1) return 1;
        let a = 1, b = 1;
        for (let i = 2; i <= n; i++) {
            let temp = b;
            b = a + b;
            a = temp;
        }
        return b;
    }

    function log(msg, type = '') {
        const logDiv = document.getElementById('log');
        const colorClass = type === 'win' ? 'win' : (type === 'loss' ? 'loss' : (type === 'tie' ? 'tie' : ''));
        logDiv.innerHTML += `<div class="${colorClass}">${msg}</div>`;
        logDiv.scrollTop = logDiv.scrollHeight;
    }

    function updateStats(status = "RUNNING") {
        document.getElementById('stat-br').innerText = bankroll.toLocaleString(undefined, {minimumFractionDigits: 2});
        document.getElementById('stat-max-bet').innerText = maxBetEncoutered.toLocaleString();
        document.getElementById('stat-mdd').innerText = maxDrawdown.toLocaleString();
        document.getElementById('stat-status').innerText = status;
        document.getElementById('hand-count').innerText = handCounter;
    }

    function resetAll() {
        location.reload();
    }

    // --- Logic Engine ---
    function calculateBet() {
        const stopLoss = parseFloat(document.getElementById('stop_loss').value);
        const fiboMult = parseFloat(document.getElementById('fibo_mult').value);
        unitSize = parseFloat(document.getElementById('unit_size').value);
        const martyMult = parseFloat(document.getElementById('marty_mult').value);
        
        let currentDrawdown = peakBankroll - bankroll;
        if (currentDrawdown >= stopLoss) {
            state = "FLAT"; martyStep = 0; fiboIdx = 0;
        }

        let rawBet = 0;
        if (state === "FLAT") {
            if (currentDrawdown > 0 && hasLostSincePeak) {
                rawBet = Math.ceil(currentDrawdown / 4);
                rawBet = Math.max(rawBet, unitSize);
            } else {
                rawBet = unitSize;
            }
        } else if (state === "MARTY") {
            rawBet = unitSize * Math.pow(martyMult, martyStep);
        } else if (state === "FIBO") {
            rawBet = getFibo(fiboIdx) * fiboMult;
        }

        let neededToRecover = currentDrawdown + unitSize;
        let bet = (state !== "FLAT") ? Math.min(rawBet, neededToRecover) : rawBet;

        let isMaxBetActive = false;
        if (bet >= stopLoss) {
            bet = stopLoss;
            isMaxBetActive = true;
        }

        // Target Adjustment
        let currentProfit = bankroll - initialBankroll;
        let remainingToTarget = targetProfit - currentProfit;
        if (bet > remainingToTarget && remainingToTarget > 0) {
            bet = Math.max(unitSize, remainingToTarget);
        }

        return { bet, isMaxBetActive };
    }

    function processResult(actualResult, bet, isMaxBetActive) {
        const sidePref = document.getElementById('side_preference').value;
        const rebateRate = parseFloat(document.getElementById('rebate_rate').value) / 100;
        
        if (actualResult === "T") {
            log(`[Hand ${handCounter}] TIE - Skip`, 'tie');
            return;
        }

        const isWin = (actualResult === "P" && sidePref === "PLAYER") || (actualResult === "B" && sidePref === "BANKER");
        const payout = (sidePref === "BANKER") ? 0.95 : 1.0;
        
        // Rebate
        const rebate = bet * rebateRate;
        bankroll += rebate;

        if (isWin) {
            bankroll += (bet * payout);
            log(`[Hand ${handCounter}] Bet: ${bet.toFixed(2)} (${actualResult}) | âœ… WIN | BR: ${bankroll.toFixed(2)}`, 'win');
            
            if (state === "FIBO") {
                fiboIdx = Math.max(-1, fiboIdx - 2);
                if (fiboIdx < 0) { state = "FLAT"; fiboIdx = 0; }
            } else {
                if (bankroll >= peakBankroll) hasLostSincePeak = false;
                state = "FLAT"; martyStep = 0;
            }
        } else {
            bankroll -= bet;
            hasLostSincePeak = true;
            log(`[Hand ${handCounter}] Bet: ${bet.toFixed(2)} (${actualResult}) | âŒ LOSS | BR: ${bankroll.toFixed(2)}`, 'loss');
            
            if (isMaxBetActive) {
                state = "FLAT"; martyStep = 0; fiboIdx = 0;
            } else {
                if (state === "FLAT") {
                    state = "MARTY"; martyStep = 1;
                } else if (state === "MARTY") {
                    martyStep++;
                    if (martyStep > 12) { state = "FIBO"; fiboIdx = 0; }
                } else if (state === "FIBO") {
                    fiboIdx++;
                }
            }
        }

        if (bet > maxBetEncoutered) maxBetEncoutered = bet;
        if (bankroll > peakBankroll) peakBankroll = bankroll;
        let currentDD = peakBankroll - bankroll;
        if (currentDD > maxDrawdown) maxDrawdown = currentDD;

        handCounter++;
        updateStats();
    }

    // --- Mode: Auto ---
    function runAuto() {
        const dataStr = document.getElementById('raw_data').value;
        const parts = dataStr.split(',');
        const results = parts.slice(1).map(s => s.trim().toUpperCase());
        
        log("--- START AUTO SESSION ---");
        for (let res of results) {
            if (bankroll <= 0 || (bankroll - initialBankroll) >= targetProfit) break;
            let { bet, isMaxBetActive } = calculateBet();
            processResult(res, bet, isMaxBetActive);
        }
        
        let finalStatus = (bankroll <= 0) ? "BUST" : ((bankroll - initialBankroll >= targetProfit) ? "WIN" : "OUT_OF_DATA");
        updateStats(finalStatus);
        log(`--- SESSION END: ${finalStatus} ---`);
    }

    // --- Mode: Manual ---
    let currentManualBet = null;

    function startManual() {
        document.getElementById('manual-input-area').style.display = 'block';
        refreshManualDisplay();
    }

    function stopManual() {
        document.getElementById('manual-input-area').style.display = 'none';
    }

    function refreshManualDisplay() {
        currentManualBet = calculateBet();
        document.getElementById('current-bet-side').innerText = document.getElementById('side_preference').value;
        document.getElementById('current-bet-amt').innerText = currentManualBet.bet.toLocaleString(undefined, {minimumFractionDigits: 2});
    }

    function inputResult(res) {
        processResult(res, currentManualBet.bet, currentManualBet.isMaxBetActive);
        
        if (bankroll <= 0) {
            alert("BUST! Bankroll is empty.");
            stopManual();
        } else if ((bankroll - initialBankroll) >= targetProfit) {
            alert("TARGET REACHED!");
            stopManual();
        } else {
            refreshManualDisplay();
        }
    }
</script>

</body>
</html>


